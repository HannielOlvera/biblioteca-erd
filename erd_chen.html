<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Diagrama ERD Chen - Sistema Biblioteca</title>
  <meta name="description" content="Diagrama ER (Chen) del sistema Biblioteca con navegaci√≥n simple y exportaci√≥n" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext y='14' font-size='14'%3Eüìä%3C/text%3E%3C/svg%3E" />

  <!-- html2canvas para captura -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8fafc; color: #1f2937; }

    .header { background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,.1); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; gap: .75rem; flex-wrap: wrap; }
    .header h1 { font-size: 1.25rem; font-weight: 600; }
    .controls { display: flex; gap: .5rem; flex-wrap: wrap; }
    .btn { background: #3b82f6; color: #fff; border: none; padding: .5rem .9rem; border-radius: 6px; cursor: pointer; font-size: .875rem; font-weight: 500; text-decoration: none; transition: transform .15s ease, background .15s ease; }
    .btn:hover { background: #2563eb; transform: translateY(-1px); }
    .btn-secondary { background: #6b7280; }
    .btn-secondary:hover { background: #4b5563; }
    .btn-success { background: #10b981; }
    .btn-success:hover { background: #059669; }

    .container { position: relative; height: calc(100vh - 80px); overflow: hidden; background: #fff; margin: 1rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,.1); }
    #diagram { width: 100%; height: 100%; overflow: hidden; cursor: grab; }
    #diagram:active { cursor: grabbing; }
    #diagram svg { max-width: none !important; max-height: none !important; transform-origin: 0 0; }

    .instructions { position: absolute; top: 1rem; left: 1rem; background: rgba(59,130,246,.08); border: 1px solid rgba(59,130,246,.25); border-radius: 8px; padding: .9rem; max-width: 300px; z-index: 10; }
    .instructions h3 { font-size: .85rem; color: #1d4ed8; margin-bottom: .4rem; }
    .instructions p { font-size: .75rem; color: #374151; line-height: 1.35; }

    .status { position: absolute; bottom: 1rem; left: 1rem; right: 1rem; background: rgba(0,0,0,.8); color: #fff; padding: .5rem 1rem; border-radius: 6px; font: 12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; text-align: center; z-index: 10; }

    .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 5; color: #6b7280; }
    .spinner { width: 40px; height: 40px; border: 4px solid #e5e7eb; border-top: 4px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto .75rem; }
    @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }

    .toast { position: fixed; top: 20px; right: 20px; background: #10b981; color: #fff; padding: 10px 14px; border-radius: 8px; font-size: 13px; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,.15); animation: slideIn .25s ease; }
    .toast.error { background: #ef4444; }
    @keyframes slideIn { from{ transform: translateX(100%); opacity: 0 } to{ transform: translateX(0); opacity: 1 } }
    @keyframes slideOut { from{ transform: translateX(0); opacity: 1 } to{ transform: translateX(100%); opacity: 0 } }

    /* Estilos del diagrama (clases del SVG) */
    .box { fill: #fff; stroke: #1f2937; stroke-width: 1.5; }
    .diamond { fill: #f8fafc; stroke: #1f2937; stroke-width: 1.5; }
    .oval { fill: #f1f5f9; stroke: #475569; stroke-width: 1.2; }
    .edge { stroke: #374151; stroke-width: 1.2; fill: none; }
    .label { font: 600 15px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; fill: #111827; }
    .small { font: 500 13px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; fill: #374151; }
    .mini { font: 400 12px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; fill: #4b5563; }

    @media (max-width: 768px) {
      .header { padding: 1rem; flex-direction: column; text-align: center; }
      .controls { justify-content: center; }
      .container { margin: .5rem; height: calc(100vh - 120px); }
      .instructions { position: static; margin: 1rem; max-width: none; }
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>üìä Diagrama ERD Chen - Sistema Biblioteca</h1>
    <div class="controls">
      <button class="btn" onclick="autoFit()">üéØ Auto-fit</button>
      <button class="btn" onclick="zoomIn()">üîç+</button>
      <button class="btn" onclick="zoomOut()">üîç‚àí</button>
      <button class="btn" onclick="resetView()">‚Üª Reset</button>
      <button class="btn btn-secondary" onclick="showHelp()">‚ùì Ayuda</button>
      <a class="btn btn-secondary" href="index.html">‚Üê Volver</a>
    </div>
  </header>

  <div class="container">
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Cargando diagrama...</p>
    </div>

    <div class="instructions">
      <h3>üìñ Navegaci√≥n</h3>
      <p><strong>Arrastrar:</strong> Clic y arrastra<br>
      <strong>Zoom:</strong> Rueda del mouse<br>
      <strong>Auto-fit:</strong> Doble clic<br>
      <strong>Teclado:</strong> Flechas, +/-</p>
    </div>

    <div id="diagram">
      <!-- SVG redise√±ado: entidades, relaciones y l√≠neas separadas, sin superposiciones, y todas las tablas del SQL -->
      <svg id="erd" viewBox="0 0 18000 12000" xmlns="http://www.w3.org/2000/svg">
        <!-- DIAGRAMA HORIZONTAL ESTILO CHEN PROFESIONAL -->
        <!-- Estado -->
        <g id="Estado">
          <rect class="box" x="500" y="1000" width="220" height="60" rx="4"/>
          <text class="label" x="610" y="1040" text-anchor="middle">Estado</text>
          <ellipse class="oval" cx="500" cy="900" rx="70" ry="24"/>
          <text class="mini" x="500" y="904" text-anchor="middle">ID_estado</text>
          <ellipse class="oval" cx="720" cy="900" rx="70" ry="24"/>
          <text class="mini" x="720" y="904" text-anchor="middle">Nombre</text>
        </g>
        <!-- Relaci√≥n Estado-Ciudad -->
        <g id="R_Estado_Ciudad">
          <polygon class="diamond" points="900,1030 940,1000 980,1030 940,1060"/>
          <text class="small" x="940" y="1040" text-anchor="middle">Pertenece</text>
        </g>
        <path class="edge" d="M720 1030 L900 1030" />
        <!-- Ciudad -->
        <g id="Ciudad">
          <rect class="box" x="1100" y="1000" width="220" height="60" rx="4"/>
          <text class="label" x="1210" y="1040" text-anchor="middle">Ciudad</text>
          <ellipse class="oval" cx="1100" cy="900" rx="70" ry="24"/>
          <text class="mini" x="1100" y="904" text-anchor="middle">ID_ciudad</text>
          <ellipse class="oval" cx="1320" cy="900" rx="70" ry="24"/>
          <text class="mini" x="1320" y="904" text-anchor="middle">Nombre</text>
          <ellipse class="oval" cx="1210" cy="1150" rx="70" ry="24"/>
          <text class="mini" x="1210" y="1154" text-anchor="middle">ID_estado</text>
        </g>
        <path class="edge" d="M980 1030 L1100 1030" />
        <!-- Relaci√≥n Ciudad-Colonia -->
        <g id="R_Ciudad_Colonia">
          <polygon class="diamond" points="1500,1030 1540,1000 1580,1030 1540,1060"/>
          <text class="small" x="1540" y="1040" text-anchor="middle">Pertenece</text>
        </g>
        <path class="edge" d="M1320 1030 L1500 1030" />
        <!-- Colonia -->
        <g id="Colonia">
          <rect class="box" x="1700" y="1000" width="240" height="60" rx="4"/>
          <text class="label" x="1820" y="1040" text-anchor="middle">Colonia</text>
          <ellipse class="oval" cx="1700" cy="900" rx="70" ry="24"/>
          <text class="mini" x="1700" y="904" text-anchor="middle">ID_colonia</text>
          <ellipse class="oval" cx="1940" cy="900" rx="70" ry="24"/>
          <text class="mini" x="1940" y="904" text-anchor="middle">Nombre</text>
          <ellipse class="oval" cx="1820" cy="1150" rx="60" ry="22"/>
          <text class="mini" x="1820" y="1154" text-anchor="middle">CP</text>
          <ellipse class="oval" cx="1820" cy="1250" rx="70" ry="24"/>
          <text class="mini" x="1820" y="1254" text-anchor="middle">ID_ciudad</text>
        </g>
        <path class="edge" d="M1580 1030 L1700 1030" />
        <!-- Relaci√≥n Colonia-Direccion -->
        <g id="R_Colonia_Direccion">
          <polygon class="diamond" points="2100,1030 2140,1000 2180,1030 2140,1060"/>
          <text class="small" x="2140" y="1040" text-anchor="middle">Pertenece</text>
        </g>
        <path class="edge" d="M1940 1030 L2100 1030" />
        <!-- Direccion -->
        <g id="Direccion">
          <rect class="box" x="2300" y="1000" width="260" height="60" rx="4"/>
          <text class="label" x="2430" y="1040" text-anchor="middle">Direcci√≥n</text>
          <ellipse class="oval" cx="2320" cy="900" rx="70" ry="24"/>
          <text class="mini" x="2320" y="904" text-anchor="middle">ID_direccion</text>
          <ellipse class="oval" cx="2540" cy="900" rx="70" ry="24"/>
          <text class="mini" x="2540" y="904" text-anchor="middle">Calle</text>
          <ellipse class="oval" cx="2430" cy="1150" rx="70" ry="24"/>
          <text class="mini" x="2430" y="1154" text-anchor="middle">NumeroExterior</text>
          <ellipse class="oval" cx="2430" cy="1250" rx="70" ry="24"/>
          <text class="mini" x="2430" y="1254" text-anchor="middle">NumeroInterior</text>
          <ellipse class="oval" cx="2430" cy="1350" rx="70" ry="24"/>
          <text class="mini" x="2430" y="1354" text-anchor="middle">Referencia</text>
          <ellipse class="oval" cx="2430" cy="1450" rx="70" ry="24"/>
          <text class="mini" x="2430" y="1454" text-anchor="middle">ID_colonia</text>
        </g>
        <path class="edge" d="M2180 1030 L2300 1030" />
        <!-- ...contin√∫a el diagrama horizontal para todas las entidades y relaciones principales... -->
        
        <!-- BANDA 2: USUARIOS Y CONTACTO -->
        <!-- TipoUsuario -->
        <g id="TipoUsuario">
          <rect class="box" x="500" y="2000" width="340" height="60" rx="4"/>
          <text class="label" x="670" y="2040" text-anchor="middle">TipoUsuario</text>
          <ellipse class="oval" cx="560" cy="1900" rx="90" ry="24"/>
          <text class="mini" x="560" y="1904" text-anchor="middle">ID_tipoUsuario</text>
          <ellipse class="oval" cx="760" cy="1900" rx="90" ry="24"/>
          <text class="mini" x="760" y="1904" text-anchor="middle">Nombre</text>
        </g>
        <!-- Usuario -->
        <g id="Usuario">
          <rect class="box" x="1200" y="2000" width="400" height="60" rx="4"/>
          <text class="label" x="1400" y="2040" text-anchor="middle">Usuario</text>
          <ellipse class="oval" cx="1260" cy="1900" rx="90" ry="24"/>
          <text class="mini" x="1260" y="1904" text-anchor="middle">ID_usuario</text>
          <ellipse class="oval" cx="1460" cy="1900" rx="90" ry="24"/>
          <text class="mini" x="1460" y="1904" text-anchor="middle">Nombre</text>
          <ellipse class="oval" cx="1340" cy="2150" rx="90" ry="24"/>
          <text class="mini" x="1340" y="2154" text-anchor="middle">ApellidoPaterno</text>
          <ellipse class="oval" cx="1460" cy="2250" rx="90" ry="24"/>
          <text class="mini" x="1460" y="2254" text-anchor="middle">ApellidoMaterno</text>
          <ellipse class="oval" cx="1580" cy="2150" rx="90" ry="24"/>
          <text class="mini" x="1580" y="2154" text-anchor="middle">Correo</text>
          <ellipse class="oval" cx="1400" cy="2350" rx="90" ry="24"/>
          <text class="mini" x="1400" y="2354" text-anchor="middle">ID_tipoUsuario</text>
          <ellipse class="oval" cx="1400" cy="2450" rx="90" ry="24"/>
          <text class="mini" x="1400" y="2454" text-anchor="middle">ID_direccion</text>
        </g>
        <!-- Relaci√≥n Usuario-TipoUsuario -->
        <g id="R_Usuario_TipoUsuario">
          <polygon class="diamond" points="950,2030 990,2000 1030,2030 990,2060"/>
          <text class="small" x="990" y="2040" text-anchor="middle">Es</text>
        </g>
        <path class="edge" d="M840 2030 Q900 2030 950 2030" />
        <path class="edge" d="M1030 2030 Q1100 2030 1200 2030" />
        <text class="small" x="1100" y="2020">N:1</text>
        <!-- Relaci√≥n Usuario-Direccion -->
        <g id="R_Usuario_Direccion">
          <polygon class="diamond" points="1700,2030 1740,2000 1780,2030 1740,2060"/>
          <text class="small" x="1740" y="2040" text-anchor="middle">ViveEn</text>
        </g>
        <path class="edge" d="M1600 2030 Q1650 2030 1700 2030" />
        <path class="edge" d="M1780 2030 Q2000 2030 2800 530" />
        <text class="small" x="1900" y="1980">N:1</text>
        <!-- Telefono -->
        <g id="Telefono">
          <rect class="box" x="2200" y="2000" width="340" height="60" rx="4"/>
          <text class="label" x="2370" y="2040" text-anchor="middle">Tel√©fono</text>
          <ellipse class="oval" cx="2260" cy="1900" rx="90" ry="24"/>
          <text class="mini" x="2260" y="1904" text-anchor="middle">ID_telefono</text>
          <ellipse class="oval" cx="2460" cy="1900" rx="90" ry="24"/>
          <text class="mini" x="2460" y="1904" text-anchor="middle">Numero</text>
          <ellipse class="oval" cx="2370" cy="2150" rx="90" ry="24"/>
          <text class="mini" x="2370" y="2154" text-anchor="middle">ID_usuario</text>
        </g>
        <!-- Relaci√≥n Usuario-Telefono -->
        <g id="R_Usuario_Telefono">
          <polygon class="diamond" points="1900,2030 1940,2000 1980,2030 1940,2060"/>
          <text class="small" x="1940" y="2040" text-anchor="middle">Tiene</text>
        </g>
        <path class="edge" d="M1600 2030 Q1750 2100 1900 2030" />
        <path class="edge" d="M1980 2030 Q2100 2030 2200 2030" />
        <text class="small" x="2050" y="2020">1:N</text>
        
        <!-- BANDA 3: LIBROS Y RELACIONADOS -->
        <!-- Editorial -->
        <g id="Editorial">
          <rect class="box" x="500" y="3500" width="340" height="60" rx="4"/>
          <text class="label" x="670" y="3540" text-anchor="middle">Editorial</text>
          <ellipse class="oval" cx="560" cy="3400" rx="90" ry="24"/>
          <text class="mini" x="560" y="3404" text-anchor="middle">ID_editorial</text>
          <ellipse class="oval" cx="760" cy="3400" rx="90" ry="24"/>
          <text class="mini" x="760" y="3404" text-anchor="middle">Nombre</text>
        </g>
        <!-- Libro -->
        <g id="Libro">
          <rect class="box" x="1200" y="3500" width="400" height="60" rx="4"/>
          <text class="label" x="1400" y="3540" text-anchor="middle">Libro</text>
          <ellipse class="oval" cx="1260" cy="3400" rx="90" ry="24"/>
          <text class="mini" x="1260" y="3404" text-anchor="middle">ID_libro</text>
          <ellipse class="oval" cx="1460" cy="3400" rx="90" ry="24"/>
          <text class="mini" x="1460" y="3404" text-anchor="middle">Titulo</text>
          <ellipse class="oval" cx="1340" cy="3650" rx="90" ry="24"/>
          <text class="mini" x="1340" y="3654" text-anchor="middle">Anio</text>
          <ellipse class="oval" cx="1460" cy="3750" rx="90" ry="24"/>
          <text class="mini" x="1460" y="3754" text-anchor="middle">ISBN</text>
          <ellipse class="oval" cx="1580" cy="3650" rx="90" ry="24"/>
          <text class="mini" x="1580" y="3654" text-anchor="middle">ID_editorial</text>
        </g>
        <!-- Relaci√≥n Libro-Editorial -->
        <g id="R_Libro_Editorial">
          <polygon class="diamond" points="950,3530 990,3500 1030,3530 990,3560"/>
          <text class="small" x="990" y="3540" text-anchor="middle">EditadoPor</text>
        </g>
        <path class="edge" d="M840 3530 Q900 3530 950 3530" />
        <path class="edge" d="M1030 3530 Q1100 3530 1200 3530" />
        <text class="small" x="1100" y="3520">N:1</text>
        <!-- Autor -->
        <g id="Autor">
          <rect class="box" x="2200" y="3500" width="340" height="60" rx="4"/>
          <text class="label" x="2370" y="3540" text-anchor="middle">Autor</text>
          <ellipse class="oval" cx="2260" cy="3400" rx="90" ry="24"/>
          <text class="mini" x="2260" y="3404" text-anchor="middle">ID_autor</text>
          <ellipse class="oval" cx="2460" cy="3400" rx="90" ry="24"/>
          <text class="mini" x="2460" y="3404" text-anchor="middle">Nombre</text>
        </g>
        <!-- Libro_Autor (tabla puente) -->
        <g id="Libro_Autor">
          <rect class="box" x="1700" y="3900" width="340" height="60" rx="4"/>
          <text class="label" x="1870" y="3940" text-anchor="middle">Libro_Autor</text>
          <ellipse class="oval" cx="1760" cy="3800" rx="90" ry="24"/>
          <text class="mini" x="1760" y="3804" text-anchor="middle">ID_libro</text>
          <ellipse class="oval" cx="1960" cy="3800" rx="90" ry="24"/>
          <text class="mini" x="1960" y="3804" text-anchor="middle">ID_autor</text>
        </g>
        <!-- Relaci√≥n Libro-Libro_Autor -->
        <g id="R_Libro_LibroAutor">
          <polygon class="diamond" points="1500,3700 1540,3670 1580,3700 1540,3730"/>
          <text class="small" x="1540" y="3710" text-anchor="middle">EscritoPor</text>
        </g>
        <path class="edge" d="M1580 3670 Q1600 3750 1700 3900" />
        <path class="edge" d="M1400 3560 Q1450 3700 1500 3700" />
        <text class="small" x="1550" y="3690">N:M</text>
        <!-- Relaci√≥n Autor-Libro_Autor -->
        <g id="R_Autor_LibroAutor">
          <polygon class="diamond" points="2100,3700 2140,3670 2180,3700 2140,3730"/>
          <text class="small" x="2140" y="3710" text-anchor="middle">Participa</text>
        </g>
        <path class="edge" d="M2370 3560 Q2250 3700 2180 3700" />
        <path class="edge" d="M2260 3670 Q2000 3750 1960 3800" />
        <text class="small" x="2200" y="3690">N:M</text>
        <!-- Genero -->
        <g id="Genero">
          <rect class="box" x="3000" y="3500" width="340" height="60" rx="4"/>
          <text class="label" x="3170" y="3540" text-anchor="middle">G√©nero</text>
          <ellipse class="oval" cx="3060" cy="3400" rx="90" ry="24"/>
          <text class="mini" x="3060" y="3404" text-anchor="middle">ID_genero</text>
          <ellipse class="oval" cx="3260" cy="3400" rx="90" ry="24"/>
          <text class="mini" x="3260" y="3404" text-anchor="middle">Nombre</text>
        </g>
        <!-- Libro_Genero (tabla puente) -->
        <g id="Libro_Genero">
          <rect class="box" x="2700" y="3900" width="340" height="60" rx="4"/>
          <text class="label" x="2870" y="3940" text-anchor="middle">Libro_G√©nero</text>
          <ellipse class="oval" cx="2760" cy="3800" rx="90" ry="24"/>
          <text class="mini" x="2760" y="3804" text-anchor="middle">ID_libro</text>
          <ellipse class="oval" cx="2960" cy="3800" rx="90" ry="24"/>
          <text class="mini" x="2960" y="3804" text-anchor="middle">ID_genero</text>
        </g>
        <!-- Relaci√≥n Libro-Libro_Genero -->
        <g id="R_Libro_LibroGenero">
          <polygon class="diamond" points="1700,3560 1740,3530 1780,3560 1740,3590"/>
          <text class="small" x="1740" y="3570" text-anchor="middle">ClasificadoComo</text>
        </g>
        <path class="edge" d="M1580 3530 Q2000 3530 2700 3900" />
        <path class="edge" d="M1400 3560 Q1450 3700 1700 3560" />
        <text class="small" x="1800" y="3550">N:M</text>
        <!-- Relaci√≥n Genero-Libro_Genero -->
        <g id="R_Genero_LibroGenero">
          <polygon class="diamond" points="3300,3700 3340,3670 3380,3700 3340,3730"/>
          <text class="small" x="3340" y="3710" text-anchor="middle">Incluye</text>
        </g>
        <path class="edge" d="M3170 3560 Q3200 3700 3300 3700" />
        <path class="edge" d="M3260 3670 Q3000 3750 2960 3800" />
        <text class="small" x="3250" y="3690">N:M</text>
        
        <!-- BANDA 4: PR√âSTAMOS Y EJEMPLARES -->
        <!-- Prestamo -->
        <g id="Prestamo">
          <rect class="box" x="500" y="5000" width="340" height="60" rx="4"/>
          <text class="label" x="670" y="5040" text-anchor="middle">Pr√©stamo</text>
          <ellipse class="oval" cx="560" cy="4900" rx="90" ry="24"/>
          <text class="mini" x="560" y="4904" text-anchor="middle">ID_prestamo</text>
          <ellipse class="oval" cx="760" cy="4900" rx="90" ry="24"/>
          <text class="mini" x="760" y="4904" text-anchor="middle">Fecha</text>
          <ellipse class="oval" cx="670" cy="5150" rx="90" ry="24"/>
          <text class="mini" x="670" y="5154" text-anchor="middle">ID_usuario</text>
        </g>
        <!-- Prestamo_Detalle -->
        <g id="Prestamo_Detalle">
          <rect class="box" x="1200" y="5400" width="400" height="60" rx="4"/>
          <text class="label" x="1400" y="5440" text-anchor="middle">Prestamo_Detalle</text>
          <ellipse class="oval" cx="1260" cy="5300" rx="90" ry="24"/>
          <text class="mini" x="1260" y="5304" text-anchor="middle">ID_prestamo</text>
          <ellipse class="oval" cx="1460" cy="5300" rx="90" ry="24"/>
          <text class="mini" x="1460" y="5304" text-anchor="middle">ID_ejemplar</text>
          <ellipse class="oval" cx="1340" cy="5550" rx="90" ry="24"/>
          <text class="mini" x="1340" y="5554" text-anchor="middle">FechaDevolucion</text>
          <ellipse class="oval" cx="1460" cy="5650" rx="90" ry="24"/>
          <text class="mini" x="1460" y="5654" text-anchor="middle">Estado</text>
        </g>
        <!-- Relaci√≥n Prestamo-Prestamo_Detalle -->
        <g id="R_Prestamo_PrestamoDetalle">
          <polygon class="diamond" points="950,5430 990,5400 1030,5430 990,5460"/>
          <text class="small" x="990" y="5440" text-anchor="middle">Incluye</text>
        </g>
        <path class="edge" d="M840 5430 Q900 5430 950 5430" />
        <path class="edge" d="M1030 5430 Q1100 5430 1200 5430" />
        <text class="small" x="1100" y="5420">1:N</text>
        <!-- Ejemplar -->
        <g id="Ejemplar">
          <rect class="box" x="2200" y="5000" width="340" height="60" rx="4"/>
          <text class="label" x="2370" y="5040" text-anchor="middle">Ejemplar</text>
          <ellipse class="oval" cx="2260" cy="4900" rx="90" ry="24"/>
          <text class="mini" x="2260" y="4904" text-anchor="middle">ID_ejemplar</text>
          <ellipse class="oval" cx="2460" cy="4900" rx="90" ry="24"/>
          <text class="mini" x="2460" y="4904" text-anchor="middle">CodigoBarras</text>
          <ellipse class="oval" cx="2370" cy="5150" rx="90" ry="24"/>
          <text class="mini" x="2370" y="5154" text-anchor="middle">ID_libro</text>
        </g>
        <!-- Relaci√≥n Ejemplar-Prestamo_Detalle -->
        <g id="R_Ejemplar_PrestamoDetalle">
          <polygon class="diamond" points="1900,5430 1940,5400 1980,5430 1940,5460"/>
          <text class="small" x="1940" y="5440" text-anchor="middle">PrestadoEn</text>
        </g>
        <path class="edge" d="M2200 5430 Q2100 5430 1980 5430" />
        <path class="edge" d="M2370 5060 Q2100 5400 1940 5400" />
        <text class="small" x="2050" y="5420">1:N</text>
        <!-- Relaci√≥n Ejemplar-Libro -->
        <g id="R_Ejemplar_Libro">
          <polygon class="diamond" points="2700,5040 2740,5010 2780,5040 2740,5070"/>
          <text class="small" x="2740" y="5050" text-anchor="middle">PerteneceA</text>
        </g>
        <path class="edge" d="M2540 5040 Q2600 5040 2700 5040" />
        <path class="edge" d="M2780 5040 Q2900 5040 3170 3560" />
        <text class="small" x="2850" y="5030">N:1</text>
        
        <!-- BANDA 5: SANCIONES Y RESERVAS -->
        <!-- Sancion -->
        <g id="Sancion">
          <rect class="box" x="500" y="6500" width="340" height="60" rx="4"/>
          <text class="label" x="670" y="6540" text-anchor="middle">Sanci√≥n</text>
          <ellipse class="oval" cx="560" cy="6400" rx="90" ry="24"/>
          <text class="mini" x="560" y="6404" text-anchor="middle">ID_sancion</text>
          <ellipse class="oval" cx="760" cy="6400" rx="90" ry="24"/>
          <text class="mini" x="760" y="6404" text-anchor="middle">Motivo</text>
          <ellipse class="oval" cx="670" cy="6650" rx="90" ry="24"/>
          <text class="mini" x="670" y="6654" text-anchor="middle">Fecha</text>
          <ellipse class="oval" cx="670" cy="6750" rx="90" ry="24"/>
          <text class="mini" x="670" y="6754" text-anchor="middle">ID_usuario</text>
        </g>
        <!-- Relaci√≥n Sancion-Usuario -->
        <g id="R_Sancion_Usuario">
          <polygon class="diamond" points="950,6530 990,6500 1030,6530 990,6560"/>
          <text class="small" x="990" y="6540" text-anchor="middle">ImponeA</text>
        </g>
        <path class="edge" d="M840 6530 Q900 6530 950 6530" />
        <path class="edge" d="M1030 6530 Q1100 6530 1200 2450" />
        <text class="small" x="1100" y="6520">N:1</text>
        <!-- Reserva -->
        <g id="Reserva">
          <rect class="box" x="1200" y="7000" width="400" height="60" rx="4"/>
          <text class="label" x="1400" y="7040" text-anchor="middle">Reserva</text>
          <ellipse class="oval" cx="1260" cy="6900" rx="90" ry="24"/>
          <text class="mini" x="1260" y="6904" text-anchor="middle">ID_reserva</text>
          <ellipse class="oval" cx="1460" cy="6900" rx="90" ry="24"/>
          <text class="mini" x="1460" y="6904" text-anchor="middle">Fecha</text>
          <ellipse class="oval" cx="1340" cy="7150" rx="90" ry="24"/>
          <text class="mini" x="1340" y="7154" text-anchor="middle">ID_usuario</text>
          <ellipse class="oval" cx="1460" cy="7250" rx="90" ry="24"/>
          <text class="mini" x="1460" y="7254" text-anchor="middle">ID_ejemplar</text>
        </g>
        <!-- Relaci√≥n Reserva-Usuario -->
        <g id="R_Reserva_Usuario">
          <polygon class="diamond" points="950,7030 990,7000 1030,7030 990,7060"/>
          <text class="small" x="990" y="7040" text-anchor="middle">ReservadoPor</text>
        </g>
        <path class="edge" d="M840 7030 Q900 7030 950 7030" />
        <path class="edge" d="M1030 7030 Q1100 7030 1200 2450" />
        <text class="small" x="1100" y="7020">N:1</text>
        <!-- Relaci√≥n Reserva-Ejemplar -->
        <g id="R_Reserva_Ejemplar">
          <polygon class="diamond" points="1700,7030 1740,7000 1780,7030 1740,7060"/>
          <text class="small" x="1740" y="7040" text-anchor="middle">ReservaEjemplar</text>
        </g>
        <path class="edge" d="M1600 7030 Q1650 7030 1700 7030" />
        <path class="edge" d="M1780 7030 Q2000 7030 2200 5150" />
        <text class="small" x="1900" y="7020">N:1</text>
      </svg>
    </div>

    <div class="status" id="status">üìä Zoom: 100% | Posici√≥n: (0, 0) | Arrastra para navegar</div>
  </div>

  <script>
    // Estado de vista
    let currentScale = 1, currentX = 0, currentY = 0, isDragging = false, startX = 0, startY = 0;
    let svg = null;

    // Funci√≥n para mostrar toast
    function toast(msg, type='success'){
      const n = document.createElement('div'); 
      n.className = `toast${type==='error'?' error':''}`;
      n.textContent = msg;
      document.body.appendChild(n); 
      setTimeout(()=>{ 
        n.style.animation = 'slideOut .25s ease'; 
        setTimeout(()=>n.remove(), 250); 
      }, 3000);
    }

    function setup() {
      svg = document.getElementById('erd');
      document.getElementById('loading').style.display = 'none';

      const container = document.getElementById('diagram');
      container.addEventListener('mousedown', startDrag);
      container.addEventListener('mousemove', drag);
      container.addEventListener('mouseup', endDrag);
      container.addEventListener('mouseleave', endDrag);
      container.addEventListener('wheel', handleWheel, { passive: false });
      container.addEventListener('dblclick', autoFit);
      document.addEventListener('keydown', handleKeyboard);

      // NO auto-fit inicial para evitar que se ejecute autom√°ticamente
      toast('‚úÖ Diagrama Chen cargado correctamente');
    }

    function startDrag(e){ isDragging = true; startX = e.clientX - currentX; startY = e.clientY - currentY; }
    function drag(e){ if(!isDragging) return; e.preventDefault(); currentX = e.clientX - startX; currentY = e.clientY - startY; updateTransform(); }
    function endDrag(){ isDragging = false; }

    function handleWheel(e){
      e.preventDefault();
      const delta = e.deltaY > 0 ? 0.9 : 1.1;
      const rect = e.currentTarget.getBoundingClientRect();
      const mouseX = e.clientX - rect.left; const mouseY = e.clientY - rect.top;
      const newScale = Math.max(0.05, Math.min(8, currentScale * delta));
      const ratio = newScale / currentScale;
      currentX = mouseX - (mouseX - currentX) * ratio;
      currentY = mouseY - (mouseY - currentY) * ratio;
      currentScale = newScale; updateTransform();
    }

    function handleKeyboard(e){
      if(e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
      const step = 60;
      switch(e.key){
        case 'ArrowUp': currentY += step; break;
        case 'ArrowDown': currentY -= step; break;
        case 'ArrowLeft': currentX += step; break;
        case 'ArrowRight': currentX -= step; break;
        case '+': zoomIn(); return;
        case '-': zoomOut(); return;
        case ' ': case 'f': e.preventDefault(); autoFit(); return;
        case 'r': resetView(); return;
        default: return;
      }
      e.preventDefault(); updateTransform();
    }

    function updateTransform(){ if(svg){ svg.style.transform = `translate(${currentX}px, ${currentY}px) scale(${currentScale})`; updateStatus(); } }
    function updateStatus(){ const z = Math.round(currentScale*100), x = Math.round(currentX), y = Math.round(currentY); document.getElementById('status').textContent = `üìä Zoom: ${z}% | Posici√≥n: (${x}, ${y}) | Arrastra para navegar`; }

    function autoFit(){
      if(!svg) return; try{
        const container = document.getElementById('diagram');
        const bbox = svg.getBBox();
        const r = container.getBoundingClientRect();
        const scaleX = (r.width - 40) / bbox.width;
        const scaleY = (r.height - 40) / bbox.height;
        const s = Math.min(scaleX, scaleY, 1.5);
        currentScale = s;
        currentX = (r.width - bbox.width * s) / 2 - bbox.x * s;
        currentY = (r.height - bbox.height * s) / 2 - bbox.y * s;
        updateTransform();
        toast('üéØ Vista ajustada autom√°ticamente');
      }catch{ resetView(); }
    }

    function zoomIn(){
      const c = document.getElementById('diagram').getBoundingClientRect();
      const cx = c.width/2, cy = c.height/2; const ns = Math.min(8, currentScale*1.2); const ratio = ns/currentScale;
      currentX = cx - (cx - currentX) * ratio; currentY = cy - (cy - currentY) * ratio; currentScale = ns; updateTransform();
    }
    function zoomOut(){
      const c = document.getElementById('diagram').getBoundingClientRect();
      const cx = c.width/2, cy = c.height/2; const ns = Math.max(0.05, currentScale*0.8); const ratio = ns/currentScale;
      currentX = cx - (cx - currentX) * ratio; currentY = cy - (cy - currentY) * ratio; currentScale = ns; updateTransform();
    }

    function resetView(){ currentScale = 1; currentX = 0; currentY = 0; updateTransform(); toast('‚Üª Vista restablecida'); }


    // Descargar SVG
    function downloadSVG(){
      if(!svg){ toast('‚ùå Espera a que el diagrama termine de cargar', 'error'); return; }
      try{
        toast('üìÑ Generando archivo SVG...');
        
        const svgClone = svg.cloneNode(true);
        const bbox = svg.getBBox();
        svgClone.setAttribute('viewBox', `${bbox.x} ${bbox.y} ${bbox.width} ${bbox.height}`);
        svgClone.setAttribute('width', bbox.width); svgClone.setAttribute('height', bbox.height);
        svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
        
        const svgCode = new XMLSerializer().serializeToString(svgClone);
        const blob = new Blob([svgCode], {type: 'image/svg+xml'});
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url; link.download = 'Sistema_Biblioteca_ERD_Chen.svg';
        document.body.appendChild(link); link.click(); document.body.removeChild(link);
        URL.revokeObjectURL(url);
        toast('‚úÖ Archivo SVG descargado correctamente');
      }catch(error){
        console.error('Error:', error); toast('‚ùå Error al descargar SVG', 'error');
      }
    }

    // Mostrar ayuda
    function showHelp(){
      const helpText = `üÜò M√âTODO DE DESCARGA DISPONIBLE:

üìÑ SVG: Descarga archivo vectorial SVG  

üìã M√âTODOS ALTERNATIVOS:
‚Ä¢ Clic derecho en diagrama ‚Üí "Guardar imagen como..."
‚Ä¢ Captura de pantalla: Win + Shift + S
‚Ä¢ F12 ‚Üí Console ‚Üí document.querySelector("#erd")
‚Ä¢ Ctrl + P ‚Üí "Guardar como PDF"

üéØ NAVEGACI√ìN:
‚Ä¢ Arrastrar: Mover diagrama
‚Ä¢ Rueda: Zoom in/out  
‚Ä¢ Doble clic: Auto-ajustar
‚Ä¢ Flechas: Mover con teclado

¬°M√∫ltiples opciones para asegurar que funcione! üí™`;
      alert(helpText);
    }

    document.addEventListener('DOMContentLoaded', () => setTimeout(setup, 200));
  </script>
</body>
</html>
