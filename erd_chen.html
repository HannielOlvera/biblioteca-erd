<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>ERD - Biblioteca (V14 Ultra-espaciado)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="assets/css/styles.css" />
<style>
  html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:#fff;color:#000}
  header{padding:10px 14px;border-bottom:1px solid #ccc;background:#f7f7f7}
  h1{margin:0;font-size:16px;font-weight:600}
  main{overflow:auto}
  .wrap{min-width:10000px;min-height:8000px;display:flex;align-items:flex-start;justify-content:center;padding:12px}
  svg{background:#fff}
  .box{fill:#fff;stroke:#000;stroke-width:1}
  .diamond{fill:#fff;stroke:#000;stroke-width:1}
  .oval{fill:#fff;stroke:#000;stroke-width:1}
  .edge{stroke:#000;stroke-width:1;fill:none}
  .label{font:15px Arial, sans-serif; fill:#000}
  .small{font:14px Arial, sans-serif; fill:#000}
  .mini{font:13px Arial, sans-serif; fill:#000}
  /* Quita estilo antiguo de .controls ya que usamos toolbar global */
</style>
</head>
<body>
<header><h1>ERD - Biblioteca (V14 Ultra-espaciado)</h1></header>

<div class="container" style="background:transparent;border:none;box-shadow:none;padding:8px 14px;">
  <div class="toolbar">
    <button class="btn" id="btnPdf">Exportar PDF</button>
    <button class="btn" id="zoomIn">Zoom +</button>
    <button class="btn" id="zoomOut">Zoom −</button>
    <button class="btn" id="reset">Reset</button>
    <label class="btn" style="user-select:none; cursor:pointer;">
      <input type="checkbox" id="autoPan" style="margin-right:8px"> Auto-pan con cursor
    </label>
  </div>
</div>

<main>
  <div class="wrap">
    <svg id="erd" width="10000" height="8000" viewBox="0 0 10000 8000" xmlns="http://www.w3.org/2000/svg">
      
      <!-- ===================== BANDA SUPERIOR: GEO / USUARIO / PRÉSTAMO ===================== -->
      
      <!-- ESTADO -->
      <g id="Estado">
        <rect class="box" x="400" y="800" width="280" height="60" rx="4"/>
        <text class="label" x="540" y="836" text-anchor="middle">Estado</text>
        
        <ellipse class="oval" cx="300" cy="400" rx="100" ry="26"/><text class="mini" x="300" y="404" text-anchor="middle">ID_estado</text>
        <path class="edge" d="M300 400 L300 500 L400 500 L400 800" />
        
        <ellipse class="oval" cx="700" cy="400" rx="96" ry="26"/><text class="mini" x="700" y="404" text-anchor="middle">Nombre</text>
        <path class="edge" d="M700 400 L700 500 L540 500 L540 800" />
      </g>

      <!-- ESTADO -> CIUDAD -->
      <g id="R_Ciu_Est">
        <polygon class="diamond" points="1050,830 1090,800 1130,830 1090,860"/>
        <text class="small" x="1090" y="836" text-anchor="middle">Pertenece</text>
      </g>
      <path class="edge" d="M680 830 L1050 830" /><text class="small" x="850" y="818">1</text>

      <!-- CIUDAD -->
      <g id="Ciudad">
        <rect class="box" x="1500" y="800" width="280" height="60" rx="4"/>
        <text class="label" x="1640" y="836" text-anchor="middle">Ciudad</text>
        
        <ellipse class="oval" cx="1400" cy="400" rx="102" ry="26"/><text class="mini" x="1400" y="404" text-anchor="middle">ID_ciudad</text>
        <path class="edge" d="M1400 400 L1400 600 L1500 600 L1500 800" />
        
        <ellipse class="oval" cx="1800" cy="400" rx="96" ry="26"/><text class="mini" x="1800" y="404" text-anchor="middle">Nombre</text>
        <path class="edge" d="M1800 400 L1800 600 L1640 600 L1640 800" />
      </g>
      <path class="edge" d="M1130 830 L1500 830" /><text class="small" x="1300" y="818">N</text>

      <!-- CIUDAD -> COLONIA -->
      <g id="R_Col_Ciu">
        <polygon class="diamond" points="2150,830 2190,800 2230,830 2190,860"/>
        <text class="small" x="2190" y="836" text-anchor="middle">Pertenece</text>
      </g>
      <path class="edge" d="M1780 830 L2150 830" /><text class="small" x="1950" y="818">1</text>

      <!-- COLONIA -->
      <g id="Colonia">
        <rect class="box" x="2600" y="800" width="300" height="60" rx="4"/>
        <text class="label" x="2750" y="836" text-anchor="middle">Colonia</text>
        
        <ellipse class="oval" cx="2500" cy="400" rx="110" ry="26"/><text class="mini" x="2500" y="404" text-anchor="middle">ID_colonia</text>
        <path class="edge" d="M2500 400 L2500 600 L2600 600 L2600 800" />
        
        <ellipse class="oval" cx="2900" cy="400" rx="100" ry="26"/><text class="mini" x="2900" y="404" text-anchor="middle">Nombre</text>
        <path class="edge" d="M2900 400 L2900 600 L2750 600 L2750 800" />
        
        <ellipse class="oval" cx="2900" cy="1100" rx="70" ry="24"/><text class="mini" x="2900" y="1104" text-anchor="middle">CP</text>
        <path class="edge" d="M2750 860 L2750 1000 L2900 1000 L2900 1100" />
      </g>
      <path class="edge" d="M2230 830 L2600 830" /><text class="small" x="2400" y="818">N</text>

      <!-- COLONIA -> DIRECCIÓN -->
      <g id="R_Dir_Col">
        <polygon class="diamond" points="3300,830 3340,800 3380,830 3340,860"/>
        <text class="small" x="3340" y="836" text-anchor="middle">Pertenece</text>
      </g>
      <path class="edge" d="M2900 830 L3300 830" /><text class="small" x="3100" y="818">1</text>

      <!-- DIRECCIÓN -->
      <g id="Direccion">
        <rect class="box" x="3750" y="800" width="340" height="60" rx="4"/>
        <text class="label" x="3920" y="836" text-anchor="middle">Dirección</text>
        
        <ellipse class="oval" cx="3650" cy="400" rx="120" ry="26"/><text class="mini" x="3650" y="404" text-anchor="middle">ID_direccion</text>
        <path class="edge" d="M3650 400 L3650 600 L3750 600 L3750 800" />
        
        <ellipse class="oval" cx="4150" cy="400" rx="100" ry="26"/><text class="mini" x="4150" y="404" text-anchor="middle">Calle</text>
        <path class="edge" d="M4150 400 L4150 600 L3920 600 L3920 800" />
        
        <ellipse class="oval" cx="3650" cy="1200" rx="150" ry="26"/><text class="mini" x="3650" y="1204" text-anchor="middle">NumeroExterior</text>
        <path class="edge" d="M3750 860 L3750 1000 L3650 1000 L3650 1200" />
        
        <ellipse class="oval" cx="4150" cy="1200" rx="150" ry="26"/><text class="mini" x="4150" y="1204" text-anchor="middle">NumeroInterior</text>
        <path class="edge" d="M3920 860 L3920 1000 L4150 1000 L4150 1200" />
        
        <ellipse class="oval" cx="3920" cy="1400" rx="120" ry="26"/><text class="mini" x="3920" y="1404" text-anchor="middle">Referencia</text>
        <path class="edge" d="M3920 860 L3920 1400" />
      </g>
      <path class="edge" d="M3380 830 L3750 830" /><text class="small" x="3560" y="818">N</text>

      <!-- DIRECCIÓN -> USUARIO -->
      <g id="R_Usr_Dir">
        <polygon class="diamond" points="4500,830 4540,800 4580,830 4540,860"/>
        <text class="small" x="4540" y="836" text-anchor="middle">Vive en</text>
      </g>
      <path class="edge" d="M4090 830 L4500 830" /><text class="small" x="4300" y="818">1</text>

      <!-- USUARIO -->
      <g id="Usuario">
        <rect class="box" x="5000" y="800" width="340" height="60" rx="4"/>
        <text class="label" x="5170" y="836" text-anchor="middle">Usuario</text>
        
        <!-- Atributos superiores ultra-espaciados -->
        <ellipse class="oval" cx="4900" cy="400" rx="112" ry="26"/><text class="mini" x="4900" y="404" text-anchor="middle">ID_usu</text>
        <path class="edge" d="M4900 400 L4900 600 L5000 600 L5000 800" />
        
        <ellipse class="oval" cx="5170" cy="400" rx="108" ry="26"/><text class="mini" x="5170" y="404" text-anchor="middle">Nombre</text>
        <path class="edge" d="M5170 400 L5170 800" />
        
        <ellipse class="oval" cx="5440" cy="400" rx="108" ry="26"/><text class="mini" x="5440" y="404" text-anchor="middle">Teléfono</text>
        <path class="edge" d="M5440 400 L5440 600 L5340 600 L5340 800" />
        
        <!-- Atributos inferiores -->
        <ellipse class="oval" cx="4800" cy="1200" rx="116" ry="26"/><text class="mini" x="4800" y="1204" text-anchor="middle">Apellido</text>
        <path class="edge" d="M5000 860 L5000 1000 L4800 1000 L4800 1200" />
        
        <ellipse class="oval" cx="5170" cy="1400" rx="124" ry="26"/><text class="mini" x="5170" y="1404" text-anchor="middle">Email</text>
        <path class="edge" d="M5170 860 L5170 1400" />
        
        <ellipse class="oval" cx="5440" cy="1200" rx="124" ry="26"/><text class="mini" x="5440" y="1204" text-anchor="middle">FechaNac</text>
        <path class="edge" d="M5340 860 L5340 1000 L5440 1000 L5440 1200" />
        
        <ellipse class="oval" cx="5700" cy="1000" rx="96" ry="26"/><text class="mini" x="5700" y="1004" text-anchor="middle">Género</text>
        <path class="edge" d="M5340 830 L5700 830 L5700 974" />
      </g>
      <path class="edge" d="M4580 830 L5000 830" /><text class="small" x="4800" y="818">N</text>

      <!-- ES DE -> TIPO_USUARIO (con desvío ultra-amplio) -->
      <g id="R_Usr_Tipo">
        <polygon class="diamond" points="5170,200 5210,170 5250,200 5210,230"/>
        <text class="small" x="5210" y="206" text-anchor="middle">Es de</text>
      </g>
      <!-- Ruta ultra-separada evitando cualquier elemento -->
      <path class="edge" d="M5170 400 L5170 230" /><text class="small" x="5155" y="300">N</text>

      <!-- TIPO_USUARIO -->
      <g id="Tipo_Usuario">
        <rect class="box" x="5040" y="50" width="260" height="50" rx="4"/>
        <text class="small" x="5170" y="78" text-anchor="middle">Tipo_Usuario</text>
        
        <ellipse class="oval" cx="5040" cy="50" rx="116" ry="22"/><text class="mini" x="5040" y="54" text-anchor="middle">Descripcion</text>
        <path class="edge" d="M5040 50 L5040 50" />
        
        <ellipse class="oval" cx="5400" cy="50" rx="106" ry="22"/><text class="mini" x="5400" y="54" text-anchor="middle">ID_tipousu</text>
        <path class="edge" d="M5300 50 L5350 50" />
      </g>
      <path class="edge" d="M5210 170 L5170 170 L5170 100" /><text class="small" x="5182" y="130">1</text>

      <!-- USUARIO -> REALIZA -> PRÉSTAMO -->
      <g id="R_Realiza">
        <polygon class="diamond" points="5850,830 5890,800 5930,830 5890,860"/>
        <text class="small" x="5890" y="836" text-anchor="middle">Realiza</text>
        <text class="small" x="5890" y="794" text-anchor="middle">1:N</text>
      </g>
      <path class="edge" d="M5340 830 L5850 830" /><text class="small" x="5600" y="818">1</text>

      <!-- PRÉSTAMO -->
      <g id="Prestamo">
        <rect class="box" x="6300" y="800" width="400" height="60" rx="4"/>
        <text class="label" x="6500" y="836" text-anchor="middle">Préstamo</text>
        
        <ellipse class="oval" cx="6200" cy="400" rx="130" ry="26"/><text class="mini" x="6200" y="404" text-anchor="middle">ID_prestamo</text>
        <path class="edge" d="M6200 400 L6200 600 L6300 600 L6300 800" />
        
        <ellipse class="oval" cx="6600" cy="400" rx="150" ry="26"/><text class="mini" x="6600" y="404" text-anchor="middle">FechaPrestamo</text>
        <path class="edge" d="M6600 400 L6600 600 L6500 600 L6500 800" />
        
        <ellipse class="oval" cx="6200" cy="1200" rx="230" ry="28"/><text class="mini" x="6200" y="1204" text-anchor="middle">FechaDevolucionEsperada</text>
        <path class="edge" d="M6300 860 L6300 1000 L6200 1000 L6200 1200" />
        
        <ellipse class="oval" cx="6600" cy="1200" rx="200" ry="28"/><text class="mini" x="6600" y="1204" text-anchor="middle">FechaDevolucionReal</text>
        <path class="edge" d="M6500 860 L6500 1000 L6600 1000 L6600 1200" />
        
        <ellipse class="oval" cx="6900" cy="830" rx="110" ry="26"/><text class="mini" x="6900" y="834" text-anchor="middle">Status</text>
        <path class="edge" d="M6700 830 L6900 830" />
      </g>
      <path class="edge" d="M5930 830 L6300 830" /><text class="small" x="6120" y="818">*</text>

      <!-- ===================== BANDA MEDIA: LIBRO / TIPO / IDIOMA (ultra-espaciado) ===================== -->
      
      <!-- LIBRO -->
      <g id="Libro">
        <rect class="box" x="3500" y="3000" width="500" height="70" rx="4"/>
        <text class="label" x="3750" y="3040" text-anchor="middle">Libro</text>
        
        <!-- Atributos ultra-distanciados -->
        <ellipse class="oval" cx="3200" cy="2500" rx="115" ry="26"/><text class="mini" x="3200" y="2504" text-anchor="middle">ID_libro</text>
        <path class="edge" d="M3200 2500 L3200 2700 L3500 2700 L3500 3000" />
        
        <ellipse class="oval" cx="3750" cy="2500" rx="105" ry="26"/><text class="mini" x="3750" y="2504" text-anchor="middle">Titulo</text>
        <path class="edge" d="M3750 2500 L3750 3000" />
        
        <ellipse class="oval" cx="4300" cy="2300" rx="160" ry="26"/><text class="mini" x="4300" y="2304" text-anchor="middle">AnioPublicacion</text>
        <path class="edge" d="M4300 2300 L4300 2700 L4000 2700 L4000 3000" />
        
        <!-- Atributos inferiores -->
        <ellipse class="oval" cx="3200" cy="3500" rx="125" ry="26"/><text class="mini" x="3200" y="3504" text-anchor="middle">Subtitulo</text>
        <path class="edge" d="M3500 3070 L3500 3300 L3200 3300 L3200 3500" />
        
        <ellipse class="oval" cx="3750" cy="3500" rx="115" ry="26"/><text class="mini" x="3750" y="3504" text-anchor="middle">ISBN13</text>
        <path class="edge" d="M3750 3070 L3750 3500" />
        
        <ellipse class="oval" cx="4300" cy="3500" rx="115" ry="26"/><text class="mini" x="4300" y="3504" text-anchor="middle">ISBN10</text>
        <path class="edge" d="M4000 3070 L4000 3300 L4300 3300 L4300 3500" />
        
        <ellipse class="oval" cx="4600" cy="3300" rx="110" ry="26"/><text class="mini" x="4600" y="3304" text-anchor="middle">Edicion</text>
        <path class="edge" d="M4000 3030 L4300 3030 L4300 3300 L4600 3300" />
      </g>

      <!-- PUBLICADO POR (N:1) - Editorial muy arriba -->
      <g id="R_Publicado">
        <polygon class="diamond" points="3750,2300 3790,2270 3830,2300 3790,2330"/>
        <text class="small" x="3790" y="2306" text-anchor="middle">Publicado por</text>
      </g>
      <path class="edge" d="M3750 3000 L3750 2330" /><text class="small" x="3765" y="2660">N</text>

      <!-- EDITORIAL -->
      <g id="Editorial">
        <rect class="box" x="3650" y="2000" width="280" height="50" rx="4"/>
        <text class="small" x="3790" y="2030" text-anchor="middle">Editorial</text>
        
        <ellipse class="oval" cx="3400" cy="2000" rx="98" ry="24"/><text class="mini" x="3400" y="2004" text-anchor="middle">Nombre</text>
        <path class="edge" d="M3650 2020 L3450 2000" />
        
        <ellipse class="oval" cx="4200" cy="2000" rx="120" ry="24"/><text class="mini" x="4200" y="2004" text-anchor="middle">ID_editorial</text>
        <path class="edge" d="M3930 2020 L4150 2000" />
      </g>
      <path class="edge" d="M3790 2270 L3790 2050" /><text class="small" x="3800" y="2150">1</text>

      <!-- ES TIPO (N:1) -> TIPO_LIBRO -->
      <g id="R_Tipo">
        <polygon class="diamond" points="5000,3035 5040,3005 5080,3035 5040,3065"/>
        <text class="small" x="5040" y="3041" text-anchor="middle">Es tipo</text>
      </g>
      <path class="edge" d="M4000 3035 L5000 3035" /><text class="small" x="4500" y="3020">N</text>

      <!-- TIPO_LIBRO -->
      <g id="Tipo_Libro">
        <rect class="box" x="5300" y="3000" width="400" height="70" rx="4"/>
        <text class="small" x="5500" y="3040" text-anchor="middle">Tipo_Libro</text>
        
        <ellipse class="oval" cx="5500" cy="2500" rx="150" ry="26"/><text class="mini" x="5500" y="2504" text-anchor="middle">ID_tipolibro</text>
        <path class="edge" d="M5500 2500 L5500 3000" />
        
        <ellipse class="oval" cx="5500" cy="3500" rx="164" ry="26"/><text class="mini" x="5500" y="3504" text-anchor="middle">Descripcion</text>
        <path class="edge" d="M5500 3070 L5500 3500" />
      </g>
      <path class="edge" d="M5080 3035 L5300 3035" /><text class="small" x="5200" y="3020">1</text>

      <!-- EN IDIOMA (N:1) -> IDIOMA -->
      <g id="R_Idioma">
        <polygon class="diamond" points="6300,3035 6340,3005 6380,3035 6340,3065"/>
        <text class="small" x="6340" y="3041" text-anchor="middle">En idioma</text>
      </g>
      <path class="edge" d="M5700 3035 L6300 3035" /><text class="small" x="6000" y="3020">N</text>

      <!-- IDIOMA -->
      <g id="Idioma">
        <rect class="box" x="6600" y="3000" width="380" height="70" rx="4"/>
        <text class="small" x="6790" y="3040" text-anchor="middle">Idioma</text>
        
        <ellipse class="oval" cx="6790" cy="2500" rx="156" ry="26"/><text class="mini" x="6790" y="2504" text-anchor="middle">ID_idioma</text>
        <path class="edge" d="M6790 2500 L6790 3000" />
        
        <ellipse class="oval" cx="6790" cy="3500" rx="164" ry="26"/><text class="mini" x="6790" y="3504" text-anchor="middle">Descripcion</text>
        <path class="edge" d="M6790 3070 L6790 3500" />
      </g>
      <path class="edge" d="M6380 3035 L6600 3035" /><text class="small" x="6500" y="3020">1</text>

      <!-- ===================== BANDA INFERIOR: AUTOR / GÉNERO / EJEMPLAR (ultra-espaciado) ===================== -->
      
      <!-- ESCRIBE (N:M) -> AUTOR (corredor izquierda) -->
      <g id="R_Escribe">
        <polygon class="diamond" points="2500,4500 2540,4470 2580,4500 2540,4530"/>
        <text class="small" x="2540" y="4506" text-anchor="middle">Escribe</text>
        <text class="small" x="2580" y="4490">N:M</text>
      </g>
      <!-- Ruta con ultra-amplio desvío -->
      <path class="edge" d="M3500 3035 L2000 3035 L2000 4500 L2500 4500" />
      <text class="small" x="2150" y="3800">*</text>

      <!-- AUTOR -->
      <g id="Autor">
        <rect class="box" x="2360" y="5000" width="400" height="70" rx="4"/>
        <text class="small" x="2560" y="5040" text-anchor="middle">Autor</text>
        
        <ellipse class="oval" cx="2360" cy="5300" rx="130" ry="26"/><text class="mini" x="2360" y="5304" text-anchor="middle">ID_autor</text>
        <path class="edge" d="M2380 5070 L2376 5274" />
        
        <ellipse class="oval" cx="2760" cy="5300" rx="118" ry="26"/><text class="mini" x="2760" y="5304" text-anchor="middle">Nombre</text>
        <path class="edge" d="M2740 5070 L2750 5274" />
        
        <ellipse class="oval" cx="2560" cy="5500" rx="120" ry="26"/><text class="mini" x="2560" y="5504" text-anchor="middle">Apellido</text>
        <path class="edge" d="M2560 5070 L2560 5474" />
      </g>
      <path class="edge" d="M2540 4530 L2540 5000" /><text class="small" x="2550" y="4770">*</text>

      <!-- SE CLASIFICA (N:M) -> GÉNERO (columna centro) -->
      <g id="R_Clasifica">
        <polygon class="diamond" points="3750,4500 3790,4470 3830,4500 3790,4530"/>
        <text class="small" x="3790" y="4506" text-anchor="middle">Se clasifica</text>
        <text class="small" x="3830" y="4490">N:M</text>
      </g>
      <!-- Ruta vertical ultra-dedicada -->
      <path class="edge" d="M3750 3070 L3750 4470" />
      <text class="small" x="3765" y="3800">*</text>

      <!-- GÉNERO -->
      <g id="Genero">
        <rect class="box" x="3590" y="5000" width="400" height="70" rx="4"/>
        <text class="small" x="3790" y="5040" text-anchor="middle">Género</text>
        
        <ellipse class="oval" cx="3790" cy="5300" rx="136" ry="26"/><text class="mini" x="3790" y="5304" text-anchor="middle">ID_genero</text>
        <path class="edge" d="M3790 5070 L3790 5274" />
        
        <ellipse class="oval" cx="3790" cy="5500" rx="156" ry="26"/><text class="mini" x="3790" y="5504" text-anchor="middle">Descripcion</text>
        <path class="edge" d="M3790 5070 L3790 5474" />
      </g>
      <path class="edge" d="M3790 4530 L3790 5000" /><text class="small" x="3800" y="4770">*</text>

      <!-- TIENE (1:N) -> EJEMPLAR (corredor derecha) -->
      <g id="R_Tiene">
        <polygon class="diamond" points="5500,4500 5540,4470 5580,4500 5540,4530"/>
        <text class="small" x="5540" y="4506" text-anchor="middle">Tiene</text>
      </g>
      <!-- Ruta con ultra-amplio rodeo -->
      <path class="edge" d="M4000 3070 L4500 3070 L4500 4300 L5500 4300 L5500 4470" />
      <text class="small" x="4700" y="4000">1</text>

      <!-- EJEMPLAR -->
      <g id="Ejemplar">
        <rect class="box" x="5340" y="5000" width="450" height="70" rx="4"/>
        <text class="small" x="5565" y="5040" text-anchor="middle">Ejemplar</text>
        
        <ellipse class="oval" cx="5340" cy="5300" rx="132" ry="26"/><text class="mini" x="5340" y="5304" text-anchor="middle">ID_ejemplar</text>
        <path class="edge" d="M5360 5070 L5356 5274" />
        
        <ellipse class="oval" cx="5790" cy="5300" rx="160" ry="26"/><text class="mini" x="5790" y="5304" text-anchor="middle">CodigoBarras</text>
        <path class="edge" d="M5770 5070 L5780 5274" />
        
        <ellipse class="oval" cx="5340" cy="5500" rx="130" ry="26"/><text class="mini" x="5340" y="5504" text-anchor="middle">Ubicacion</text>
        <path class="edge" d="M5360 5070 L5356 5474" />
        
        <ellipse class="oval" cx="5790" cy="5500" rx="176" ry="26"/><text class="mini" x="5790" y="5504" text-anchor="middle">EstadoEjemplar</text>
        <path class="edge" d="M5770 5070 L5780 5474" />
      </g>
      <path class="edge" d="M5540 4530 L5540 5000" /><text class="small" x="5550" y="4770">*</text>

      <!-- CONTIENE (N:M) PRÉSTAMO->EJEMPLAR (corredor extremo derecha) -->
      <g id="R_Contiene">
        <polygon class="diamond" points="8000,2200 8040,2170 8080,2200 8040,2230"/>
        <text class="small" x="8040" y="2206" text-anchor="middle">Contiene</text>
        <text class="small" x="8080" y="2190">N:M</text>
      </g>
      <!-- Ruta ultra-rodeo evitando todo -->
      <path class="edge" d="M6500 860 L6500 1500 L8000 1500 L8000 2170" />
      <text class="small" x="6550" y="1300">*</text>
      <path class="edge" d="M8080 2200 L9000 2200 L9000 5300 L5790 5300" />
      <text class="small" x="8900" y="3750">*</text><text class="small" x="8000" y="3750">*</text>

    </svg>
  </div>
</main>

<!-- Librerías para exportación a PDF -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/svg2pdf.js@2.2.1/dist/svg2pdf.umd.min.js"></script>
<script src="assets/js/pdf-export.js"></script>

<script>
  // Pan/Zoom sobre viewBox + Exportar PDF
  (function(){
    const svg = document.getElementById('erd');
    const content = { w: (svg.width && svg.width.baseVal ? svg.width.baseVal.value : 10000), h: (svg.height && svg.height.baseVal ? svg.height.baseVal.value : 8000) };
    const view = { x: 0, y: 0, w: content.w, h: content.h };
    const wrap = document.querySelector('.wrap');

    function applyView(){ svg.setAttribute('viewBox', `${view.x} ${view.y} ${view.w} ${view.h}`); }
    function clampView(){
      if(view.w > content.w) view.w = content.w;
      if(view.h > content.h) view.h = content.h;
      const maxX = Math.max(0, content.w - view.w);
      const maxY = Math.max(0, content.h - view.h);
      if(view.x < 0) view.x = 0; if(view.y < 0) view.y = 0;
      if(view.x > maxX) view.x = maxX; if(view.y > maxY) view.y = maxY;
    }
    function clientScale(){
      const rect = svg.getBoundingClientRect();
      return { sx: view.w / rect.width, sy: view.h / rect.height };
    }

    // Drag-to-pan
    let dragging = false; let start = { mx:0, my:0, x:0, y:0 };
    wrap.addEventListener('mousedown', (e)=>{
      dragging = true; start.mx = e.clientX; start.my = e.clientY; start.x = view.x; start.y = view.y;
      wrap.style.cursor = 'grabbing'; e.preventDefault();
    });
    window.addEventListener('mousemove', (e)=>{
      if(!dragging) return; const {sx, sy} = clientScale();
      const dx = (e.clientX - start.mx) * sx; const dy = (e.clientY - start.my) * sy;
      view.x = start.x - dx; view.y = start.y - dy; clampView(); applyView();
    });
    window.addEventListener('mouseup', ()=>{ dragging = false; wrap.style.cursor='default'; });

    // Wheel zoom (centrado)
    svg.addEventListener('wheel', (e)=>{
      e.preventDefault(); const factor = e.deltaY < 0 ? 0.9 : 1.1;
      const cx = view.x + view.w/2; const cy = view.y + view.h/2;
      view.w = Math.max(200, Math.min(content.w, view.w * factor));
      view.h = Math.max(200, Math.min(content.h, view.h * factor));
      view.x = cx - view.w/2; view.y = cy - view.h/2; clampView(); applyView();
    }, { passive:false });

    // Auto-pan en bordes (opcional)
    const autoPan = document.getElementById('autoPan');
    wrap.addEventListener('mousemove', (e)=>{
      if(!autoPan || !autoPan.checked || dragging) return;
      const rect = svg.getBoundingClientRect(); const margin = 40; const {sx, sy} = clientScale();
      let moved = false;
      if(e.clientX < rect.left + margin) { view.x -= 20 * sx; moved = true; }
      if(e.clientX > rect.right - margin) { view.x += 20 * sx; moved = true; }
      if(e.clientY < rect.top + margin) { view.y -= 20 * sy; moved = true; }
      if(e.clientY > rect.bottom - margin) { view.y += 20 * sy; moved = true; }
      if(moved){ clampView(); applyView(); }
    });

    // Controles
    document.getElementById('zoomIn').addEventListener('click', ()=> svg.dispatchEvent(new WheelEvent('wheel', { deltaY: -100 })));
    document.getElementById('zoomOut').addEventListener('click', ()=> svg.dispatchEvent(new WheelEvent('wheel', { deltaY: 100 })));
    document.getElementById('reset').addEventListener('click', ()=>{ view.x=0; view.y=0; view.w=content.w; view.h=content.h; applyView(); });

    // Exportar PDF
    document.getElementById('btnPdf').addEventListener('click', ()=>{
      if(window.exportSvgToPdf) window.exportSvgToPdf(svg, 'ERD_Biblioteca.pdf'); else alert('Exportación PDF no disponible.');
    });

    // Inicializa
    applyView();
  })();
</script>
</body>
</html>