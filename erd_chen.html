<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>ERD (Chen) ‚Äì Biblioteca Profesional</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Diagrama ER (Chen) del sistema Biblioteca con navegaci√≥n avanzada, zoom/pan fluido y exportaci√≥n profesional a PDF." />
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext y='14' font-size='14'%3Eüìä%3C/text%3E%3C/svg%3E" />

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<link rel="stylesheet" href="assets/css/styles.css" />
<style>
  body {
    margin: 0;
    font-family: var(--font-sans);
    background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
    background-attachment: fixed;
    color: var(--text);
    min-height: 100vh;
  }
  
  .page-header {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--glass-border);
    padding: var(--space-md) var(--space-lg);
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  
  .header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-lg);
    flex-wrap: wrap;
  }
  
  .page-title {
    font-size: clamp(1.25rem, 3vw, 1.75rem);
    font-weight: 700;
    margin: 0;
    background: linear-gradient(135deg, #ffffff 0%, rgba(255,255,255,0.8) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .main-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--space-lg);
  }
  
  .diagram-wrapper {
    background: #fff;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-2xl);
    overflow: hidden;
    position: relative;
    min-height: 600px;
    border: 1px solid rgba(0,0,0,0.1);
  }
  
  .diagram-wrapper::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary-600), var(--accent), var(--primary-600));
    z-index: 10;
  }
  
  .svg-container {
    width: 100%;
    height: 80vh;
    min-height: 600px;
    overflow: hidden;
    position: relative;
    cursor: grab;
    background: #fff;
  }
  
  .svg-container.dragging {
    cursor: grabbing !important;
  }
  
  .svg-container svg {
    width: 100%;
    height: 100%;
    display: block;
  }
  
  /* SVG Styles for high contrast and readability */
  .box { fill: #fff; stroke: #1f2937; stroke-width: 1.5; }
  .diamond { fill: #f8fafc; stroke: #1f2937; stroke-width: 1.5; }
  .oval { fill: #f1f5f9; stroke: #475569; stroke-width: 1.2; }
  .edge { stroke: #374151; stroke-width: 1.2; fill: none; }
  .label { font: 600 15px var(--font-sans); fill: #111827; }
  .small { font: 500 13px var(--font-sans); fill: #374151; }
  .mini { font: 400 12px var(--font-sans); fill: #4b5563; }
  
  /* Enhanced toolbar */
  .enhanced-toolbar {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    z-index: 100;
    background: rgba(255,255,255,0.95);
    padding: var(--space-sm);
    border-radius: var(--radius-lg);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(0,0,0,0.1);
    box-shadow: var(--shadow-lg);
  }
  
  .enhanced-toolbar .btn {
    color: #374151;
    font-size: 0.8rem;
    padding: var(--space-xs) var(--space-md);
    background: rgba(255,255,255,0.8);
    border: 1px solid rgba(0,0,0,0.1);
  }
  
  .enhanced-toolbar .btn:hover {
    background: rgba(255,255,255,1);
    color: #111827;
    box-shadow: var(--shadow-md);
  }
  
  .status-bar {
    position: absolute;
    bottom: var(--space-md);
    left: var(--space-md);
    background: rgba(0,0,0,0.8);
    color: white;
    padding: var(--space-xs) var(--space-md);
    border-radius: var(--radius-md);
    font-size: 0.8rem;
    font-family: var(--font-mono);
    z-index: 100;
    backdrop-filter: blur(10px);
  }
  
  /* Loading indicator */
  .loading-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #6b7280;
    font-size: 1.1rem;
    z-index: 50;
  }
  
  @media (max-width: 768px) {
    .header-content {
      flex-direction: column;
      text-align: center;
      gap: var(--space-md);
    }
    
    .enhanced-toolbar {
      position: static;
      margin-bottom: var(--space-md);
      justify-content: center;
    }
    
    .svg-container {
      height: 60vh;
      min-height: 400px;
    }
  }
</style>
</head>
<body>
  <header class="page-header">
    <div class="header-content">
      <div style="display: flex; align-items: center; gap: var(--space-md);">
        <a href="index.html" class="btn btn--ghost" aria-label="Volver al √≠ndice">‚Üê Volver</a>
        <h1 class="page-title">üìä Diagrama ER (Chen) - Biblioteca</h1>
      </div>
      
      <div class="enhanced-toolbar">
        <button class="btn" id="btnAutoFit" title="Ajustar a pantalla (Espacio)">üéØ Auto-fit</button>
        <button class="btn" id="btnPdf" title="Exportar a PDF">üìÑ PDF</button>
        <button class="btn" id="zoomIn" title="Acercar (+)">üîç+</button>
        <button class="btn" id="zoomOut" title="Alejar (-)">üîç‚àí</button>
        <button class="btn" id="reset" title="Restablecer vista">‚Üª Reset</button>
        <label class="btn control-group" style="cursor: pointer;" title="Activar desplazamiento autom√°tico en bordes">
          <input type="checkbox" id="autoPan" style="margin-right: 6px; accent-color: var(--accent);"> 
          Auto-pan
        </label>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="diagram-wrapper">
      <div class="loading-indicator" id="loadingIndicator">
        Cargando diagrama... ‚è≥
      </div>
      
      <div class="svg-container" id="svgContainer">
        <svg id="erd" viewBox="0 0 10000 8000" xmlns="http://www.w3.org/2000/svg">
          
          <!-- ===================== BANDA SUPERIOR: GEO / USUARIO / PR√âSTAMO ===================== -->
          
          <!-- ESTADO -->
          <g id="Estado">
            <rect class="box" x="400" y="800" width="280" height="60" rx="4"/>
            <text class="label" x="540" y="836" text-anchor="middle">Estado</text>
            
            <ellipse class="oval" cx="300" cy="400" rx="100" ry="26"/><text class="mini" x="300" y="404" text-anchor="middle">ID_estado</text>
            <path class="edge" d="M300 400 L300 500 L400 500 L400 800" />
            
            <ellipse class="oval" cx="700" cy="400" rx="96" ry="26"/><text class="mini" x="700" y="404" text-anchor="middle">Nombre</text>
            <path class="edge" d="M700 400 L700 500 L540 500 L540 800" />
          </g>

          <!-- ESTADO -> CIUDAD -->
          <g id="R_Ciu_Est">
            <polygon class="diamond" points="1050,830 1090,800 1130,830 1090,860"/>
            <text class="small" x="1090" y="836" text-anchor="middle">Pertenece</text>
          </g>
          <path class="edge" d="M680 830 L1050 830" /><text class="small" x="850" y="818">1</text>

          <!-- CIUDAD -->
          <g id="Ciudad">
            <rect class="box" x="1500" y="800" width="280" height="60" rx="4"/>
            <text class="label" x="1640" y="836" text-anchor="middle">Ciudad</text>
            
            <ellipse class="oval" cx="1400" cy="400" rx="102" ry="26"/><text class="mini" x="1400" y="404" text-anchor="middle">ID_ciudad</text>
            <path class="edge" d="M1400 400 L1400 600 L1500 600 L1500 800" />
            
            <ellipse class="oval" cx="1800" cy="400" rx="96" ry="26"/><text class="mini" x="1800" y="404" text-anchor="middle">Nombre</text>
            <path class="edge" d="M1800 400 L1800 600 L1640 600 L1640 800" />
          </g>
          <path class="edge" d="M1130 830 L1500 830" /><text class="small" x="1300" y="818">N</text>

          <!-- CIUDAD -> COLONIA -->
          <g id="R_Col_Ciu">
            <polygon class="diamond" points="2150,830 2190,800 2230,830 2190,860"/>
            <text class="small" x="2190" y="836" text-anchor="middle">Pertenece</text>
          </g>
          <path class="edge" d="M1780 830 L2150 830" /><text class="small" x="1950" y="818">1</text>

          <!-- COLONIA -->
          <g id="Colonia">
            <rect class="box" x="2600" y="800" width="300" height="60" rx="4"/>
            <text class="label" x="2750" y="836" text-anchor="middle">Colonia</text>
            
            <ellipse class="oval" cx="2500" cy="400" rx="110" ry="26"/><text class="mini" x="2500" y="404" text-anchor="middle">ID_colonia</text>
            <path class="edge" d="M2500 400 L2500 600 L2600 600 L2600 800" />
            
            <ellipse class="oval" cx="2900" cy="400" rx="100" ry="26"/><text class="mini" x="2900" y="404" text-anchor="middle">Nombre</text>
            <path class="edge" d="M2900 400 L2900 600 L2750 600 L2750 800" />
            
            <ellipse class="oval" cx="2900" cy="1100" rx="70" ry="24"/><text class="mini" x="2900" y="1104" text-anchor="middle">CP</text>
            <path class="edge" d="M2750 860 L2750 1000 L2900 1000 L2900 1100" />
          </g>
          <path class="edge" d="M2230 830 L2600 830" /><text class="small" x="2400" y="818">N</text>

          <!-- COLONIA -> DIRECCI√ìN -->
          <g id="R_Dir_Col">
            <polygon class="diamond" points="3300,830 3340,800 3380,830 3340,860"/>
            <text class="small" x="3340" y="836" text-anchor="middle">Pertenece</text>
          </g>
          <path class="edge" d="M2900 830 L3300 830" /><text class="small" x="3100" y="818">1</text>

          <!-- DIRECCI√ìN -->
          <g id="Direccion">
            <rect class="box" x="3750" y="800" width="340" height="60" rx="4"/>
            <text class="label" x="3920" y="836" text-anchor="middle">Direcci√≥n</text>
            
            <ellipse class="oval" cx="3650" cy="400" rx="120" ry="26"/><text class="mini" x="3650" y="404" text-anchor="middle">ID_direccion</text>
            <path class="edge" d="M3650 400 L3650 600 L3750 600 L3750 800" />
            
            <ellipse class="oval" cx="4150" cy="400" rx="100" ry="26"/><text class="mini" x="4150" y="404" text-anchor="middle">Calle</text>
            <path class="edge" d="M4150 400 L4150 600 L3920 600 L3920 800" />
            
            <ellipse class="oval" cx="3650" cy="1200" rx="150" ry="26"/><text class="mini" x="3650" y="1204" text-anchor="middle">NumeroExterior</text>
            <path class="edge" d="M3750 860 L3750 1000 L3650 1000 L3650 1200" />
            
            <ellipse class="oval" cx="4150" cy="1200" rx="150" ry="26"/><text class="mini" x="4150" y="1204" text-anchor="middle">NumeroInterior</text>
            <path class="edge" d="M3920 860 L3920 1000 L4150 1000 L4150 1200" />
            
            <ellipse class="oval" cx="3920" cy="1400" rx="120" ry="26"/><text class="mini" x="3920" y="1404" text-anchor="middle">Referencia</text>
            <path class="edge" d="M3920 860 L3920 1400" />
          </g>
          <path class="edge" d="M3380 830 L3750 830" /><text class="small" x="3560" y="818">N</text>

          <!-- DIRECCI√ìN -> USUARIO -->
          <g id="R_Usr_Dir">
            <polygon class="diamond" points="4500,830 4540,800 4580,830 4540,860"/>
            <text class="small" x="4540" y="836" text-anchor="middle">Vive en</text>
          </g>
          <path class="edge" d="M4090 830 L4500 830" /><text class="small" x="4300" y="818">1</text>

          <!-- USUARIO -->
          <g id="Usuario">
            <rect class="box" x="5000" y="800" width="340" height="60" rx="4"/>
            <text class="label" x="5170" y="836" text-anchor="middle">Usuario</text>
            
            <!-- Atributos superiores ultra-espaciados -->
            <ellipse class="oval" cx="4900" cy="400" rx="112" ry="26"/><text class="mini" x="4900" y="404" text-anchor="middle">ID_usu</text>
            <path class="edge" d="M4900 400 L4900 600 L5000 600 L5000 800" />
            
            <ellipse class="oval" cx="5170" cy="400" rx="108" ry="26"/><text class="mini" x="5170" y="404" text-anchor="middle">Nombre</text>
            <path class="edge" d="M5170 400 L5170 800" />
            
            <ellipse class="oval" cx="5440" cy="400" rx="108" ry="26"/><text class="mini" x="5440" y="404" text-anchor="middle">Tel√©fono</text>
            <path class="edge" d="M5440 400 L5440 600 L5340 600 L5340 800" />
            
            <!-- Atributos inferiores -->
            <ellipse class="oval" cx="4800" cy="1200" rx="116" ry="26"/><text class="mini" x="4800" y="1204" text-anchor="middle">Apellido</text>
            <path class="edge" d="M5000 860 L5000 1000 L4800 1000 L4800 1200" />
            
            <ellipse class="oval" cx="5170" cy="1400" rx="124" ry="26"/><text class="mini" x="5170" y="1404" text-anchor="middle">Email</text>
            <path class="edge" d="M5170 860 L5170 1400" />
            
            <ellipse class="oval" cx="5440" cy="1200" rx="124" ry="26"/><text class="mini" x="5440" y="1204" text-anchor="middle">FechaNac</text>
            <path class="edge" d="M5340 860 L5340 1000 L5440 1000 L5440 1200" />
            
            <ellipse class="oval" cx="5700" cy="1000" rx="96" ry="26"/><text class="mini" x="5700" y="1004" text-anchor="middle">G√©nero</text>
            <path class="edge" d="M5340 830 L5700 830 L5700 974" />
          </g>
          <path class="edge" d="M4580 830 L5000 830" /><text class="small" x="4800" y="818">N</text>

          <!-- ES DE -> TIPO_USUARIO (con desv√≠o ultra-amplio) -->
          <g id="R_Usr_Tipo">
            <polygon class="diamond" points="5170,200 5210,170 5250,200 5210,230"/>
            <text class="small" x="5210" y="206" text-anchor="middle">Es de</text>
          </g>
          <!-- Ruta ultra-separada evitando cualquier elemento -->
          <path class="edge" d="M5170 400 L5170 230" /><text class="small" x="5155" y="300">N</text>

          <!-- TIPO_USUARIO -->
          <g id="Tipo_Usuario">
            <rect class="box" x="5040" y="50" width="260" height="50" rx="4"/>
            <text class="small" x="5170" y="78" text-anchor="middle">Tipo_Usuario</text>
            
            <ellipse class="oval" cx="5040" cy="50" rx="116" ry="22"/><text class="mini" x="5040" y="54" text-anchor="middle">Descripcion</text>
            <path class="edge" d="M5040 50 L5040 50" />
            
            <ellipse class="oval" cx="5400" cy="50" rx="106" ry="22"/><text class="mini" x="5400" y="54" text-anchor="middle">ID_tipousu</text>
            <path class="edge" d="M5300 50 L5350 50" />
          </g>
          <path class="edge" d="M5210 170 L5170 170 L5170 100" /><text class="small" x="5182" y="130">1</text>

          <!-- USUARIO -> REALIZA -> PR√âSTAMO -->
          <g id="R_Realiza">
            <polygon class="diamond" points="5850,830 5890,800 5930,830 5890,860"/>
            <text class="small" x="5890" y="836" text-anchor="middle">Realiza</text>
            <text class="small" x="5890" y="794" text-anchor="middle">1:N</text>
          </g>
          <path class="edge" d="M5340 830 L5850 830" /><text class="small" x="5600" y="818">1</text>

          <!-- PR√âSTAMO -->
          <g id="Prestamo">
            <rect class="box" x="6300" y="800" width="400" height="60" rx="4"/>
            <text class="label" x="6500" y="836" text-anchor="middle">Pr√©stamo</text>
            
            <ellipse class="oval" cx="6200" cy="400" rx="130" ry="26"/><text class="mini" x="6200" y="404" text-anchor="middle">ID_prestamo</text>
            <path class="edge" d="M6200 400 L6200 600 L6300 600 L6300 800" />
            
            <ellipse class="oval" cx="6600" cy="400" rx="150" ry="26"/><text class="mini" x="6600" y="404" text-anchor="middle">FechaPrestamo</text>
            <path class="edge" d="M6600 400 L6600 600 L6500 600 L6500 800" />
            
            <ellipse class="oval" cx="6200" cy="1200" rx="230" ry="28"/><text class="mini" x="6200" y="1204" text-anchor="middle">FechaDevolucionEsperada</text>
            <path class="edge" d="M6300 860 L6300 1000 L6200 1000 L6200 1200" />
            
            <ellipse class="oval" cx="6600" cy="1200" rx="200" ry="28"/><text class="mini" x="6600" y="1204" text-anchor="middle">FechaDevolucionReal</text>
            <path class="edge" d="M6500 860 L6500 1000 L6600 1000 L6600 1200" />
            
            <ellipse class="oval" cx="6900" cy="830" rx="110" ry="26"/><text class="mini" x="6900" y="834" text-anchor="middle">Status</text>
            <path class="edge" d="M6700 830 L6900 830" />
          </g>
          <path class="edge" d="M5930 830 L6300 830" /><text class="small" x="6120" y="818">*</text>

          <!-- ===================== BANDA MEDIA: LIBRO / TIPO / IDIOMA (ultra-espaciado) ===================== -->
          
          <!-- LIBRO -->
          <g id="Libro">
            <rect class="box" x="3500" y="3000" width="500" height="70" rx="4"/>
            <text class="label" x="3750" y="3040" text-anchor="middle">Libro</text>
            
            <!-- Atributos ultra-distanciados -->
            <ellipse class="oval" cx="3200" cy="2500" rx="115" ry="26"/><text class="mini" x="3200" y="2504" text-anchor="middle">ID_libro</text>
            <path class="edge" d="M3200 2500 L3200 2700 L3500 2700 L3500 3000" />
            
            <ellipse class="oval" cx="3750" cy="2500" rx="105" ry="26"/><text class="mini" x="3750" y="2504" text-anchor="middle">Titulo</text>
            <path class="edge" d="M3750 2500 L3750 3000" />
            
            <ellipse class="oval" cx="4300" cy="2300" rx="160" ry="26"/><text class="mini" x="4300" y="2304" text-anchor="middle">AnioPublicacion</text>
            <path class="edge" d="M4300 2300 L4300 2700 L4000 2700 L4000 3000" />
            
            <!-- Atributos inferiores -->
            <ellipse class="oval" cx="3200" cy="3500" rx="125" ry="26"/><text class="mini" x="3200" y="3504" text-anchor="middle">Subtitulo</text>
            <path class="edge" d="M3500 3070 L3500 3300 L3200 3300 L3200 3500" />
            
            <ellipse class="oval" cx="3750" cy="3500" rx="115" ry="26"/><text class="mini" x="3750" y="3504" text-anchor="middle">ISBN13</text>
            <path class="edge" d="M3750 3070 L3750 3500" />
            
            <ellipse class="oval" cx="4300" cy="3500" rx="115" ry="26"/><text class="mini" x="4300" y="3504" text-anchor="middle">ISBN10</text>
            <path class="edge" d="M4000 3070 L4000 3300 L4300 3300 L4300 3500" />
            
            <ellipse class="oval" cx="4600" cy="3300" rx="110" ry="26"/><text class="mini" x="4600" y="3304" text-anchor="middle">Edicion</text>
            <path class="edge" d="M4000 3030 L4300 3030 L4300 3300 L4600 3300" />
          </g>

          <!-- PUBLICADO POR (N:1) - Editorial muy arriba -->
          <g id="R_Publicado">
            <polygon class="diamond" points="3750,2300 3790,2270 3830,2300 3790,2330"/>
            <text class="small" x="3790" y="2306" text-anchor="middle">Publicado por</text>
          </g>
          <path class="edge" d="M3750 3000 L3750 2330" /><text class="small" x="3765" y="2660">N</text>

          <!-- EDITORIAL -->
          <g id="Editorial">
            <rect class="box" x="3650" y="2000" width="280" height="50" rx="4"/>
            <text class="small" x="3790" y="2030" text-anchor="middle">Editorial</text>
            
            <ellipse class="oval" cx="3400" cy="2000" rx="98" ry="24"/><text class="mini" x="3400" y="2004" text-anchor="middle">Nombre</text>
            <path class="edge" d="M3650 2020 L3450 2000" />
            
            <ellipse class="oval" cx="4200" cy="2000" rx="120" ry="24"/><text class="mini" x="4200" y="2004" text-anchor="middle">ID_editorial</text>
            <path class="edge" d="M3930 2020 L4150 2000" />
          </g>
          <path class="edge" d="M3790 2270 L3790 2050" /><text class="small" x="3800" y="2150">1</text>

          <!-- ES TIPO (N:1) -> TIPO_LIBRO -->
          <g id="R_Tipo">
            <polygon class="diamond" points="5000,3035 5040,3005 5080,3035 5040,3065"/>
            <text class="small" x="5040" y="3041" text-anchor="middle">Es tipo</text>
          </g>
          <path class="edge" d="M4000 3035 L5000 3035" /><text class="small" x="4500" y="3020">N</text>

          <!-- TIPO_LIBRO -->
          <g id="Tipo_Libro">
            <rect class="box" x="5300" y="3000" width="400" height="70" rx="4"/>
            <text class="small" x="5500" y="3040" text-anchor="middle">Tipo_Libro</text>
            
            <ellipse class="oval" cx="5500" cy="2500" rx="150" ry="26"/><text class="mini" x="5500" y="2504" text-anchor="middle">ID_tipolibro</text>
            <path class="edge" d="M5500 2500 L5500 3000" />
            
            <ellipse class="oval" cx="5500" cy="3500" rx="164" ry="26"/><text class="mini" x="5500" y="3504" text-anchor="middle">Descripcion</text>
            <path class="edge" d="M5500 3070 L5500 3500" />
          </g>
          <path class="edge" d="M5080 3035 L5300 3035" /><text class="small" x="5200" y="3020">1</text>

          <!-- EN IDIOMA (N:1) -> IDIOMA -->
          <g id="R_Idioma">
            <polygon class="diamond" points="6300,3035 6340,3005 6380,3035 6340,3065"/>
            <text class="small" x="6340" y="3041" text-anchor="middle">En idioma</text>
          </g>
          <path class="edge" d="M5700 3035 L6300 3035" /><text class="small" x="6000" y="3020">N</text>

          <!-- IDIOMA -->
          <g id="Idioma">
            <rect class="box" x="6600" y="3000" width="380" height="70" rx="4"/>
            <text class="small" x="6790" y="3040" text-anchor="middle">Idioma</text>
            
            <ellipse class="oval" cx="6790" cy="2500" rx="156" ry="26"/><text class="mini" x="6790" y="2504" text-anchor="middle">ID_idioma</text>
            <path class="edge" d="M6790 2500 L6790 3000" />
            
            <ellipse class="oval" cx="6790" cy="3500" rx="164" ry="26"/><text class="mini" x="6790" y="3504" text-anchor="middle">Descripcion</text>
            <path class="edge" d="M6790 3070 L6790 3500" />
          </g>
          <path class="edge" d="M6380 3035 L6600 3035" /><text class="small" x="6500" y="3020">1</text>

          <!-- ===================== BANDA INFERIOR: AUTOR / G√âNERO / EJEMPLAR (ultra-espaciado) ===================== -->
          
          <!-- ESCRIBE (N:M) -> AUTOR (corredor izquierda) -->
          <g id="R_Escribe">
            <polygon class="diamond" points="2500,4500 2540,4470 2580,4500 2540,4530"/>
            <text class="small" x="2540" y="4506" text-anchor="middle">Escribe</text>
            <text class="small" x="2580" y="4490">N:M</text>
          </g>
          <!-- Ruta con ultra-amplio desv√≠o -->
          <path class="edge" d="M3500 3035 L2000 3035 L2000 4500 L2500 4500" />
          <text class="small" x="2150" y="3800">*</text>

          <!-- AUTOR -->
          <g id="Autor">
            <rect class="box" x="2360" y="5000" width="400" height="70" rx="4"/>
            <text class="small" x="2560" y="5040" text-anchor="middle">Autor</text>
            
            <ellipse class="oval" cx="2360" cy="5300" rx="130" ry="26"/><text class="mini" x="2360" y="5304" text-anchor="middle">ID_autor</text>
            <path class="edge" d="M2380 5070 L2376 5274" />
            
            <ellipse class="oval" cx="2760" cy="5300" rx="118" ry="26"/><text class="mini" x="2760" y="5304" text-anchor="middle">Nombre</text>
            <path class="edge" d="M2740 5070 L2750 5274" />
            
            <ellipse class="oval" cx="2560" cy="5500" rx="120" ry="26"/><text class="mini" x="2560" y="5504" text-anchor="middle">Apellido</text>
            <path class="edge" d="M2560 5070 L2560 5474" />
          </g>
          <path class="edge" d="M2540 4530 L2540 5000" /><text class="small" x="2550" y="4770">*</text>

          <!-- SE CLASIFICA (N:M) -> G√âNERO (columna centro) -->
          <g id="R_Clasifica">
            <polygon class="diamond" points="3750,4500 3790,4470 3830,4500 3790,4530"/>
            <text class="small" x="3790" y="4506" text-anchor="middle">Se clasifica</text>
            <text class="small" x="3830" y="4490">N:M</text>
          </g>
          <!-- Ruta vertical ultra-dedicada -->
          <path class="edge" d="M3750 3070 L3750 4470" />
          <text class="small" x="3765" y="3800">*</text>

          <!-- G√âNERO -->
          <g id="Genero">
            <rect class="box" x="3590" y="5000" width="400" height="70" rx="4"/>
            <text class="small" x="3790" y="5040" text-anchor="middle">G√©nero</text>
            
            <ellipse class="oval" cx="3790" cy="5300" rx="136" ry="26"/><text class="mini" x="3790" y="5304" text-anchor="middle">ID_genero</text>
            <path class="edge" d="M3790 5070 L3790 5274" />
            
            <ellipse class="oval" cx="3790" cy="5500" rx="156" ry="26"/><text class="mini" x="3790" y="5504" text-anchor="middle">Descripcion</text>
            <path class="edge" d="M3790 5070 L3790 5474" />
          </g>
          <path class="edge" d="M3790 4530 L3790 5000" /><text class="small" x="3800" y="4770">*</text>

          <!-- TIENE (1:N) -> EJEMPLAR (corredor derecha) -->
          <g id="R_Tiene">
            <polygon class="diamond" points="5500,4500 5540,4470 5580,4500 5540,4530"/>
            <text class="small" x="5540" y="4506" text-anchor="middle">Tiene</text>
          </g>
          <!-- Ruta con ultra-amplio rodeo -->
          <path class="edge" d="M4000 3070 L4500 3070 L4500 4300 L5500 4300 L5500 4470" />
          <text class="small" x="4700" y="4000">1</text>

          <!-- EJEMPLAR -->
          <g id="Ejemplar">
            <rect class="box" x="5340" y="5000" width="450" height="70" rx="4"/>
            <text class="small" x="5565" y="5040" text-anchor="middle">Ejemplar</text>
            
            <ellipse class="oval" cx="5340" cy="5300" rx="132" ry="26"/><text class="mini" x="5340" y="5304" text-anchor="middle">ID_ejemplar</text>
            <path class="edge" d="M5360 5070 L5356 5274" />
            
            <ellipse class="oval" cx="5790" cy="5300" rx="160" ry="26"/><text class="mini" x="5790" y="5304" text-anchor="middle">CodigoBarras</text>
            <path class="edge" d="M5770 5070 L5780 5274" />
            
            <ellipse class="oval" cx="5340" cy="5500" rx="130" ry="26"/><text class="mini" x="5340" y="5504" text-anchor="middle">Ubicacion</text>
            <path class="edge" d="M5360 5070 L5356 5474" />
            
            <ellipse class="oval" cx="5790" cy="5500" rx="176" ry="26"/><text class="mini" x="5790" y="5504" text-anchor="middle">EstadoEjemplar</text>
            <path class="edge" d="M5770 5070 L5780 5474" />
          </g>
          <path class="edge" d="M5540 4530 L5540 5000" /><text class="small" x="5550" y="4770">*</text>

          <!-- CONTIENE (N:M) PR√âSTAMO->EJEMPLAR (corredor extremo derecha) -->
          <g id="R_Contiene">
            <polygon class="diamond" points="8000,2200 8040,2170 8080,2200 8040,2230"/>
            <text class="small" x="8040" y="2206" text-anchor="middle">Contiene</text>
            <text class="small" x="8080" y="2190">N:M</text>
          </g>
          <!-- Ruta ultra-rodeo evitando todo -->
          <path class="edge" d="M6500 860 L6500 1500 L8000 1500 L8000 2170" />
          <text class="small" x="6550" y="1300">*</text>
          <path class="edge" d="M8080 2200 L9000 2200 L9000 5300 L5790 5300" />
          <text class="small" x="8900" y="3750">*</text><text class="small" x="8000" y="3750">*</text>

        </svg>
      </div>
      
      <div class="status-bar" id="statusBar">
        Zoom: 100% | Posici√≥n: (0, 0) | Arrastra para mover ‚Ä¢ Rueda para zoom
      </div>
    </div>
  </main>

  <!-- Librer√≠as para exportaci√≥n a PDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/svg2pdf.js@2.2.1/dist/svg2pdf.umd.min.js"></script>
  
  <!-- Sistema ultra-avanzado de funcionalidades -->
  <script src="assets/js/notifications.js"></script>
  <script src="assets/js/pdf-export.js"></script>
  <script src="assets/js/ultra-advanced-pan-zoom.js"></script>
  <script src="assets/js/smooth-interaction-engine.js"></script>
  <script src="assets/js/erd-context-menu.js"></script>
  <script src="assets/js/keyboard-shortcuts.js"></script>
  <script src="assets/js/performance-monitor.js"></script>
  <script src="assets/js/main.js" type="module"></script>

  <script>
    // Initialize advanced pan/zoom for Chen diagram
    document.addEventListener('DOMContentLoaded', () => {
      const svg = document.getElementById('erd');
      const container = document.getElementById('svgContainer');
      const statusBar = document.getElementById('statusBar');
      const loadingIndicator = document.getElementById('loadingIndicator');
      
      // Hide loading indicator with welcome message
      setTimeout(() => {
        loadingIndicator.style.display = 'none';
        window.BibliotecaERD?.showNotification('Diagrama Chen cargado exitosamente', 'success', 2500, 'Sistema Listo');
      }, 500);
      
      // Initialize ultra-advanced pan/zoom with ultra-smooth interactions
      const panZoom = new UltraAdvancedPanZoom(svg, {
        enablePan: true,
        enableZoom: true,
        enableAutoFit: true,
        enableSmoothing: true,
        enableAutoPan: false,
        enableInertia: true,
        enableBoundaries: true,
        rightClickPan: true,
        smoothingFactor: 0.08,    // Ultra-responsive
        zoomStep: 0.12,           // Precision zoom steps
        maxZoom: 15,              // Higher zoom for detailed inspection
        minZoom: 0.03,            // Lower min zoom for overview
        inertia: 0.96,            // High inertia for smooth glides
        friction: 0.82,           // Lower friction for longer momentum
        edgePanSpeed: 35,
        edgePanMargin: 80,
        doubleClickZoom: true,
        mouseWheelZoom: true,
        touchSupport: true,
        showCursor: true,
        cursorTransition: true
      });
      
      // Initialize smooth interaction engine for ultra-fluid experience
      const smoothEngine = new SmoothInteractionEngine(svg, panZoom);
      
      // Initialize enhanced right-click context menu
      const contextMenu = new ERDContextMenu(svg, panZoom);
      
      // Initialize keyboard shortcuts
      const keyboard = new KeyboardShortcuts(panZoom);
      
      // Enhanced status bar updates with ultra-smooth performance monitoring
      let lastUpdate = Date.now();
      function updateStatusBar() {
        const now = Date.now();
        if (now - lastUpdate < 33) return; // Throttle to 30 FPS for smoothness
        lastUpdate = now;
        
        const zoom = Math.round(panZoom.state.scale * 100);
        const x = Math.round(panZoom.state.x);
        const y = Math.round(panZoom.state.y);
        const fps = panZoom.performanceMetrics?.fps || 60;
        const isInteracting = smoothEngine.getInteractionStats().isInteracting ? 'üéØ' : 'üìä';
        
        statusBar.textContent = `${isInteracting} Zoom: ${zoom}% | Posici√≥n: (${x}, ${y}) | FPS: ${fps} | Right-click para opciones | Alt+H para ayuda`;
      }
      
      // Update status bar with RAF for smooth performance
      function animate() {
        updateStatusBar();
        requestAnimationFrame(animate);
      }
      animate();
      
      // Enhanced toolbar button connections
      document.getElementById('btnAutoFit').addEventListener('click', () => {
        panZoom.autoFit();
        window.BibliotecaERD?.showNotification('Vista ajustada autom√°ticamente', 'success', 2000);
      });
      
      document.getElementById('zoomIn').addEventListener('click', () => {
        panZoom.zoomIn();
        window.BibliotecaERD?.showNotification(`Zoom: ${Math.round(panZoom.state.scale * 100)}%`, 'info', 1500);
      });
      
      document.getElementById('zoomOut').addEventListener('click', () => {
        panZoom.zoomOut();
        window.BibliotecaERD?.showNotification(`Zoom: ${Math.round(panZoom.state.scale * 100)}%`, 'info', 1500);
      });
      
      document.getElementById('reset').addEventListener('click', () => {
        panZoom.reset();
        window.BibliotecaERD?.showNotification('Vista restablecida a configuraci√≥n inicial', 'info', 2000);
      });
      
      // Enhanced auto-pan toggle with user feedback
      const autoPanCheckbox = document.getElementById('autoPan');
      autoPanCheckbox.addEventListener('change', (e) => {
        panZoom.options.enableAutoPan = e.target.checked;
        const message = e.target.checked ? 
          'Auto-pan activado: mueve el cursor a los bordes para navegar' : 
          'Auto-pan desactivado';
        const type = e.target.checked ? 'success' : 'info';
        window.BibliotecaERD?.showNotification(message, type, 3000);
      });
      
      // Enhanced PDF Export with progress feedback
      document.getElementById('btnPdf').addEventListener('click', async () => {
        if (!window.exportSvgToPdf) {
          window.BibliotecaERD?.showNotification('Error: Sistema de exportaci√≥n PDF no disponible', 'error', 5000);
          return;
        }
        
        const loadingId = window.BibliotecaERD?.showNotification(
          'Preparando exportaci√≥n PDF... Por favor espera', 
          'info', 
          0, 
          'Generando PDF'
        );
        
        try {
          await new Promise(resolve => setTimeout(resolve, 100)); // Small delay for UI feedback
          await window.exportSvgToPdf(svg, 'ERD_Chen_Biblioteca_Profesional.pdf', { 
            format: 'a3',
            quality: 'high',
            margin: 20
          });
          
          if (loadingId) window.BibliotecaERD?.notifications?.remove(loadingId);
          window.BibliotecaERD?.showNotification(
            'PDF exportado exitosamente con calidad profesional', 
            'success', 
            4000, 
            'Exportaci√≥n Completa'
          );
        } catch (error) {
          console.error('PDF export error:', error);
          if (loadingId) window.BibliotecaERD?.notifications?.remove(loadingId);
          window.BibliotecaERD?.showNotification(
            'Error durante la exportaci√≥n. Int√©ntalo nuevamente', 
            'error', 
            5000
          );
        }
      });
      
      // Double-click auto-fit
      container.addEventListener('dblclick', (e) => {
        e.preventDefault();
        panZoom.autoFit();
        window.BibliotecaERD?.showNotification('Vista ajustada por doble clic', 'info', 1500);
      });
      
      // Welcome message with ultra-enhanced instructions
      setTimeout(() => {
        window.BibliotecaERD?.showNotification(
          'Sistema ultra-avanzado cargado: Alt+H para atajos, Right-click para opciones', 
          'info', 
          6000,
          'Ultra Tip Profesional'
        );
      }, 3000);
      
      // Advanced performance monitoring with interaction feedback
      let performanceWarningShown = false;
      let lastInteractionTime = Date.now();
      
      // Listen for interaction events to provide feedback
      svg.addEventListener('panZoomChange', (e) => {
        lastInteractionTime = Date.now();
      });
      
      setInterval(() => {
        const scale = panZoom.state.scale;
        const stats = smoothEngine.getInteractionStats();
        
        if (scale > 8 && !performanceWarningShown) {
          window.BibliotecaERD?.showNotification(
            'Zoom ultra-alto detectado. El sistema se adapta autom√°ticamente para mantener fluidez.', 
            'warning', 
            5000,
            'Optimizaci√≥n Autom√°tica'
          );
          performanceWarningShown = true;
        } else if (scale <= 8) {
          performanceWarningShown = false;
        }
        
        // Show interaction tips periodically
        const timeSinceInteraction = Date.now() - lastInteractionTime;
        if (timeSinceInteraction > 30000 && Math.random() < 0.1) { // 10% chance every 30 seconds
          const tips = [
            'Usa doble-click para auto-ajustar la vista',
            'Mant√©n presionado el bot√≥n derecho para navegaci√≥n alternativa',
            'Las flechas del teclado permiten navegaci√≥n precisa',
            'El zoom con rueda del mouse se centra en el cursor'
          ];
          const randomTip = tips[Math.floor(Math.random() * tips.length)];
          window.BibliotecaERD?.showNotification(randomTip, 'info', 4000, 'Tip de Navegaci√≥n');
          lastInteractionTime = Date.now(); // Reset timer
        }
      }, 5000);
      
      // Expose ultra-advanced instances for debugging and external access
      window.erdPanZoom = panZoom;
      window.erdSmoothEngine = smoothEngine;
      window.erdContextMenu = contextMenu;
      
      console.log('üöÄ Ultra-Advanced ERD Chen Diagram initialized successfully');
      console.log('üéØ Features: Ultra-Smooth Pan/Zoom, Right-click Context Menu, Enhanced Interactions');
      console.log('‚å®Ô∏è Press Alt+H for keyboard shortcuts | Right-click for context menu');
      console.log('üìä Performance stats available via window.erdSmoothEngine.getInteractionStats()');
    });
  </script>
</body>
</html>
